<?xml version="1.0" encoding="UTF-8" ?>
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.timr.applet.login" version="0.5.0.0">
    <icon>app://openiz.org/drawable/cog.png</icon>
    <name lang="en">Login Applet</name>
    <groupName lang="en">OpenIZ Core</groupName>
    <author>OpenIZ Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>
  </info>
  <asset name="index" mimeType="text/html">
    <contentHtml>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>select2</bundle>
      <bundle>angular</bundle>
      <style>app://openiz.org/asset/css/bootstrap-alterations.css</style>
      <script>index-controller</script>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml" ng-controller="LoginController">
          <div class="container">
            <div class="row">
              <div class="col-xs-12">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h3 class="panel-title text-center">Login</h3>
                  </div>
                  <div class="panel-body">
                    <img src="app://openiz.org/drawable/coat_of_arms_of_tanzania" class="img-responsive center-block"/>
                    <form novalidate="novalidate">
                      <fieldset class="form-group">
                        <legend class="control-label">Enter your username and password below</legend>
                        <div class="form-group">
                            <label for="usernameInput" class="control-label">User Name:</label>
                            <input ng-model="username" type="text" ng-required="true" placeholder="User Name" class="form-control" name="username" id="usernameInput"/>
                        </div>
                        <div class="form-group">
                            <label for="passwordInput" class="control-label">Password:</label>
                            <input ng-model="password" type="password" ng-required="true" class="form-control" name="password" id="passwordInput"/>
                        </div>
                      </fieldset>
                        <div class ="row">
                          <div class="col-xs-12 text-center">
                            <a class="btn btn-success pull-left" href="app://openiz.org/applet/org.timr.applet.register/index"> Register</a>
                            <a class="btn btn-warning" href="app://openiz.org/applet/org.timr.applet.login/resetName"> Forgot Password?</a>
                            <a class="btn btn-primary pull-right" href="app://openiz.org/applet/org.timr.applet.dashboard/index" ng-click="login(username, password)">Login</a>
                          </div>
                        </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset name="resetName" mimeType="text/html">
    <contentHtml>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>select2</bundle>
      <bundle>angular</bundle>
      <style>app://openiz.org/asset/css/bootstrap-alterations.css</style>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml">
          <div class="container">
            <div class="row">
              <div class="col-xs-12">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h3 class="panel-title text-center">Forgot Password</h3>
                  </div>
                  <div class="panel-body">
                    <form novalidate="novalidate">
                      <fieldset class="form-group">
                        <legend class="control-label">Enter your User Name below</legend>
                        <div class="form-group">
                            <label for="usernameInput" class="control-label">User Name:</label>
                            <input ng-model="username" type="text" ng-required="true" placeholder="User Name" class="form-control" name="username" id="usernameInput"/>
                        </div>
                      </fieldset>
                        <div class ="row">
                          <div class="col-xs-12 text-center">
                            <a class="btn btn-primary pull-right" href="app://openiz.org/applet/org.timr.applet.login/reset">Check User Name</a>
                          </div>
                        </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset name="reset" mimeType="text/html">
    <contentHtml>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>select2</bundle>
      <bundle>angular</bundle>
      <style>app://openiz.org/asset/css/bootstrap-alterations.css</style>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml">
          <div class="container">
            <div class="row">
              <div class="col-xs-12">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h3 class="panel-title text-center">Password Recovery</h3>
                  </div>
                  <div class="panel-body">
                    <form novalidate="novalidate">
                      <fieldset class="form-group">
                        <legend class="control-label">Select your recovery method</legend>
                        <div class="form-group">
                          <div class="radio">
                            <label for="emailRadio" class="radio-inline control-label">Email<input id="emailRadio" type="radio" name="resetMethod" value="Email"></input></label>  
                          </div>
                          <div class="radio">
                            <label for="phoneRadio" class="radio-inline control-label">Phone Number<input id="phoneRadio" type="radio" name="resetMethod" value="Phone"></input></label>  
                        </div>
                        </div>
                      </fieldset>
                        <div class ="row">
                          <div class="col-xs-12 text-center">
                            <a class="btn btn-primary pull-right" href="app://openiz.org/applet/org.timr.applet.login/verify">Send Verification Code</a>
                          </div>
                        </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset name="verify" mimeType="text/html">
    <contentHtml>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>select2</bundle>
      <bundle>angular</bundle>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml">
          <div class="container">
            <div class="row">
              <h3 class="text-center">A verification code has been sent</h3>
            </div>
            <div class="row">
              <div class ="col-xs-6 col-xs-offset-3 text-center">
                <label>
                  Verification Code
                  <input type="text"></input>
                </label>
              </div>
            </div>
            <div class = "row">
              <div class="col-xs-2 col-xs-offset-5 text-center">
                <a class="btn btn-success" href="app://openiz.org/applet/org.timr.applet.login/index">Enter</a>
              </div>
            </div>
          </div>
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset name="index-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
        var loginApp = angular.module('index', []);

		    loginApp.controller('LoginController', ['$scope', function ($scope)
		    {
			    $scope.login = function(username, password) {
            try
            {
              var session = OpenIZ.Authentication.login(username, password);
              alert(session);
              if(session == null)
                alert(OpenIZ.Localization.getString("invalidCredential"));
              else
                window.location = OpenIZ.urlParams["returnUrl"];
            }
            catch(ex)
            {
              if(typeof(ex) == "string")
                alert(ex);
               else if(ex.description != undefined)
                alert(ex);
            }
          };

	    }]);
      ]]>
    </contentText>
  </asset>
</AppletManifest>
