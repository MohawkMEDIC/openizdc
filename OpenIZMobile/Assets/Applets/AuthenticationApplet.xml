<?xml version="1.0" encoding="utf-8" ?>
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.openiz.applet.core.authentication" version="0.5.0.0">
    <icon>app://openiz.org/drawable/shield</icon>
    <name lang="en">OpenIZ Authentication Core</name>
    <groupName lang="en">OpenIZ Core</groupName>
    <author>OpenIZ Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>
  </info>
  <strings lang="en">
    <string key="login">Login to</string>
    <string key="btnForgot">Forgot password</string>
    <string key="password">Password</string>
    <string key="username">User Name</string>
    <!-- Common -->
    <string key="common_btnSave">Save</string>
    <string key="common_btnCancel">Cancel</string>
    <string key="common_btnLogin">Login</string>
    <string key="common_btnLogout">Logout</string>
    <string key="common_btnRefresh">Refresh</string>
  </strings>
  <strings lang="fr">
    <string key="login">Connecter a</string>
    <string key="password">Mot de passe:</string>
    <string key="username">Nom</string>
    <string key="btnForgot">Oubile mot passe</string>
    <string key="common_btnSave">Sauver</string>
    <string key="common_btnCancel">Annuler</string>
    <string key="common_btnLogin">Login</string>
    <string key="common_btnLogout">Deconnecter</string>
    <string key="common_btnRefresh">Rafraichir</string>
  </strings>
  <strings lang="sw">
    <string key="common_btnSave">Hifadhi</string>
    <string key="common_btnCancel">Kufuta</string>
    <string key="common_btnLogin">Ingia</string>
    <string key="common_btnLogout">Ingia Kati</string>
    <string key="common_btnRefresh">Burudisha</string>
  </strings>
  <asset name="login" mimeType="text/html">
    <contentHtml>
      <title lang="en">Login to OpenIZ</title>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>angular</bundle>
      <script>login-controller</script>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml" ng-controller="LoginController">
          <h1>{{ "login" | i18n}} OpenIZ ({{config.realmName}})</h1>
          <hr/>
          <button class="btn-primary btn" ng-click="setLocale('en')">EN</button>
          <button class="btn-default btn" ng-click="setLocale('fr')">FR</button>
          <hr/>
          <form novalidate="novalidate">
            <div class="container">
              <div class="input-group">
                <span class="input-group-addon">{{ "username" | i18n}}:</span>
                <input ng-model="username" type="text" ng-required="true" placeholder="User Name" class="form-control" name="username" id="username"/>
              </div>
              <div class="input-group">
                <span class="input-group-addon">{{ "password" | i18n}}:</span>
                <input ng-model="password" type="password" ng-required="true" class="form-control" name="password" id="password"/>
              </div>
              <div class="btn-group pull-right">
                <button class="btn-danger btn" ng-disabled="username == null" ng-click="forgotPassword(username)">
                  <span class="glyphicon glyphicon-resize-full">
                  </span> {{ "btnForgot" | i18n }}
                </button>
                <button class="btn-primary btn" ng-click="login(username, password)" ng-disabled="username == null || password == null">
                  {{ "common_btnLogin" | i18n }} <span class="glyphicon glyphicon-login"></span>
                </button>
              </div>
            </div>
          </form>
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset name="login-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
        // angular stuff
			  var loginApp = angular.module('login', ['localization']);

			  loginApp.controller('LoginController', ['$scope', 'localize', function ($scope, localize)
			  {
          
            $scope.config = {
              realmName : OpenIZ.Configuration.getRealm()
            };
            $scope.locale = {};
          
          $scope.login = function(username, password) {
            try
            {
              var session = OpenIZ.Authentication.login(username, password);
              if(session == null)
                alert(OpenIZ.Localization.getString("err_oauth2_invalid_grant"));
              else
                window.location = OpenIZ.urlParams["returnUrl"];
            }
            catch(ex)
            {
              if(typeof(ex) == "string")
                alert(ex);
              else if(ex.message != undefined)
                alert("" + ex.message + " - " + ex.details);
              else
                alert(ex);
            }
          };
          
          $scope.setLocale = function(lang)
          {
              localize.setLanguage(lang);
          }
          
          $scope.forgotPassword = function(username) {
            alert(username);
          };

        }]);
      
      ]]>
    </contentText>
  </asset>

</AppletManifest>