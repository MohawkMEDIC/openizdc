<?xml version="1.0" encoding="utf-8" ?>
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.openiz.applet.core" version="0.5.0.0">
    <icon>app://openiz.org/drawable/home</icon>
    <name lang="en">OpenIZ Core</name>
    <groupName lang="en">OpenIZ Core</groupName>
    <author>OpenIZ Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>
    <!-- The OpenIZ Login Policy -->
    <demand>1.3.6.1.4.1.33349.3.1.5.9.2.1</demand>
  </info>
  <strings lang="en">
    <string key="home_greeting">Welcome to OpenIZ</string>
  </strings>
  <strings lang="fr">
    <string key="home_greeting">Bienvenue a OpenIZ</string>
  </strings>
  <asset lang="en" mimeType="text/html" name="index">
    <contentHtml>
      <title lang="en">Home</title>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>angular</bundle>
      <bundle>select2</bundle>
      <script>index-controller</script>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml" ng-controller="HomeController">
          <h1>{{ "home_greeting" | i18n }} {{session.identity.name}}</h1>
          <div>
            <ul>
              <li>
                <a href="#" ng-click="logout()">{{ "common_btnLogout" | i18n }}</a>
              </li>
              <li>
                <a href="#" ng-click="refresh()">{{ "common_btnRefresh" | i18n }}</a>
              </li>
              <li>
                <a href="not-found">Not found test</a>
              </li>
            </ul>
          </div>
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset lang="en" mimeType="text/javascript" name="index-controller">
    <contentText>
      <![CDATA[
      // angular stuff
			var indexApp = angular.module('index', ['localization']);

			indexApp.controller('HomeController', ['$scope', function ($scope)
			{
        $scope.config = {
          realmName : OpenIZ.Configuration.getRealm(),
        };
        $scope.session = OpenIZ.Authentication.getSession();

        $scope.logout = function() {
          $scope.session.abandon();
          window.location = 'app://openiz.org/applet/org.openiz.applet.core/index';
        };
        
        $scope.refresh = function() {
          try
          {
            var ses = $scope.session.refresh();
            if(ses != null) 
              window.location = 'app://openiz.org/applet/org.openiz.applet.core/index';
          }
          catch(ex)
          {
            if(typeof(ex) == "string")
              alert(ex);
            else if(ex.description != undefined)
              alert(ex.description);
              
          }
        };
      }]);
      ]]>
    </contentText>
  </asset>
</AppletManifest>