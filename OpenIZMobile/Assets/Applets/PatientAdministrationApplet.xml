<?xml version="1.0" encoding="UTF-8"?>
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.timr.applet.patientAdministration" version="0.5.0.0">
    <icon>app://openiz.org/drawable/cogs</icon>
    <name lang="en">Patient Administration</name>
    <groupName lang="en">Administration</groupName>
    <author>OpenIZ.org Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0" />
    <dependency id="org.timr.applet.layout" version="0.5.0.0"/>
  </info>
  <menuItem>
    <icon>app://openiz.org/drawable/drk_baby</icon>
    <text>Children</text>
    <menuItem launch="app://openiz.org/applet/org.timr.applet.patientAdministration/patientSearch">
      <icon>app://openiz.org/drawable/drk_patient_search</icon>
      <text>Find Child</text>
    </menuItem>
    <menuItem launch="app://openiz.org/applet/org.timr.applet.patientAdministration/patientRegister">
      <icon>app://openiz.org/drawable/drk_register_patient</icon>
      <text>Register Child</text>
    </menuItem>
  </menuItem>
  <asset name="patientSearchResultTable" mimeType="text/html">
    <contentHtml>
      <content>
        <table xmlns="http://www.w3.org/1999/xhtml" ng-if="searchResults" class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>{{ 'locale.tableHeaders.names' | i18n }}</th>
              <th>{{ 'locale.tableHeaders.dateOfBirth' | i18n }}</th>
              <th>{{ 'locale.tableHeaders.gender' | i18n }}</th>
              <th>{{ 'locale.tableHeaders.cityVillage' | i18n }}</th>
              <th>{{ 'locale.tableHeaders.healthFacility' | i18n }}</th>
              <th>{{ 'locale.tableHeaders.actions' | i18n }}</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="patient in searchResults.items">
              <td>{{ patient.display.name.OfficialRecord.Given }} {{ patient.display.name.OfficialRecord.Family }}</td>
              <td>{{ patient.dateOfBirth | date: 'yyyy-MMM-dd' }}</td>
              <td>{{ patient.display.gender.text }}</td>
              <td>N.Y.I.</td>
              <td>N.Y.I.</td>
              <td>
                <span class="btn-group">
                  <button class="btn btn-primary" ng-click="view(patient)">
                    {{ 'locale.buttonLabels.view' | i18n }}<span class="glyphicon glyphicon-eye-open"></span>
                  </button>
                  <button type="button" class="btn btn-primary" data-toggle="modal" autocomplete="off" ng-click="setModalPatient(patient, $index)" data-target="#myModal" ng-class="{'btn-success':patient.CheckedIn==true}">
                    {{ 'locale.buttonLabels.checkIn' | i18n }}
                  </button>
                </span>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="2">{{ searchResults.offset }} .. {{ searchResults.offset + searchResults.count }} of {{ searchResults.totalResults }} </td>
            </tr>
          </tfoot>
        </table>
      </content>
    </contentHtml>
  </asset>
  <asset name="patientSearch" mimeType="text/html">
    <contentHtml>
      <title lang="en">Search Children</title>
      <title lang="sw">Tafuto Watoto</title>
      <!-- absolute reference to the layout -->
      <layout>app://openiz.org/applet/org.timr.applet.layout/layout</layout>
      <script>patient-search-controller</script>
      <bundle>select2</bundle>
      <content lang="en">
        <div class="row" ng-controller="PatientSearchController"  xmlns="http://www.w3.org/1999/xhtml">
          <div class="container">
            <div class="row">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#searchPanel">{{ 'locale.buttonLabels.patientSearch' | i18n }}</a>
                  </h4>
                </div>
                <div class="panel-collapse collapse in" id="searchPanel">
                  <div class="panel-body">
                    <form name="patientSearchForm" role="form" novalidate="novalidate" ng-submit="search(patientSearchForm.$invalid)">
                      <div class="panel-group">
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h3 class="panel-title text-center">
                              <a data-toggle="collapse" href="#barcodeCollapse">{{ 'locale.panelLabels.barcodeScan' | i18n }}</a>
                            </h3>
                          </div>
                          <div id="barcodeCollapse" class="panel-collapse collapse in">
                            <div class="panel-body">
                              <fieldset class="form-horizontal">
                                <div class="form-group">
                                  <label class="col-xs-2 col-xs-offset-2 control-label" for="barcodeInput">{{ 'locale.inputLabels.identifier' | i18n }}</label>
                                  <div class="col-xs-6 input-group">
                                    <input type="number" name="barcode" id="barcodeInput" class="form-control" placeholder="{{ 'locale.placeHolders.barcode' | i18n }}" aria-describedby="barcodeAddon" ng-model="query.identifiers.value">
                                      <span class="input-group-btn">
                                        <button type="button" class="btn btn-default" ng-click="scanBarcodeLink()">
                                          <span class="glyphicon glyphicon-barcode">
                                          </span>{{ 'locale.buttonLabels.scan' | i18n }}
                                        </button>
                                      </span>
                                    </input>
                                  </div>
                                </div>
                              </fieldset>
                            </div>
                          </div>
                        </div>
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h3 class="panel-title text-center">
                              <a data-toggle="collapse" href="#patientDemographicCollapse">{{ 'locale.panelLabels.patientDemographicCriteria' | i18n }}</a>
                            </h3>
                          </div>
                          <div id="patientDemographicCollapse" class="panel-collapse collapse">
                            <div class="panel-body">
                              <fieldset class="form-horizontal">

                                <div class="form-group">
                                  <div ng-class="{ 'has-error': patientSearchForm.givenName.$invalid &amp;&amp; (patientSearchForm.givenName.$touched||patientSearchForm.$submitted)}">
                                    <label class="col-xs-2 col-xs-offset-2 control-label" for="givenNameInput">{{ 'locale.inputLabels.givenName' | i18n }}</label>
                                    <div class="col-xs-6">
                                      <input type="text" name="givenName" id="givenNameInput" ng-model="query.names.given" ng-maxlength="50" class="form-control" placeholder="{{ 'locale.placeHolders.givenName' | i18n }}" aria-describedby="givenNameAddon" />
                                    </div>
                                  </div>
                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientSearchForm.givenName.$error" ng-if="patientSearchForm.givenName.$touched||patientSearchForm.$submitted" role="alert">
                                    <div ng-message="maxlength" class="alert alert-danger">{{ 'locale.errors.fieldLong' | i18n }}</div>
                                  </div>
                                </div>

                                <div class="form-group">
                                  <div ng-class="{ 'has-error': patientSearchForm.familyName.$invalid &amp;&amp; (patientSearchForm.familyName.$touched||patientSearchForm.$submitted)}">
                                    <label class="col-xs-2 col-xs-offset-2 control-label" for="familyNameInput">{{ 'locale.inputLabels.familyName' | i18n }}</label>
                                    <div class="col-xs-6">
                                      <input type="text" name="familyName" id="familyNameInput" ng-model="query.names.family" ng-maxlength="50" class="form-control" placeholder="{{ 'locale.placeHolders.familyName' | i18n }}" aria-describedby="familyNameAddon" />
                                    </div>
                                  </div>
                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientSearchForm.familyName.$error" role="alert" ng-if="patientSearchForm.familyName.$touched||patientSearchForm.$submitted">
                                    <div ng-message="maxlength" class="alert alert-danger">{{ 'locale.errors.fieldLong' | i18n }}</div>
                                  </div>
                                </div>
                                <div class ="form-group">
                                  <label class="col-xs-2 col-xs-offset-2 control-label" for="dobFromInput">{{ 'locale.inputLabels.dateOfBirthFrom' | i18n }}</label>
                                  <div class="col-xs-6 date input-group" id="dobFromPicker">
                                    <input readonly="readonly" type="text" name="dobFrom" id="dobFromInput" class="form-control" ng-blur="updateDobFrom()" aria-describedby="dobAddon" ng-model="query.dob.from" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popupFrom.opened" datepicker-options="dateOptionsFrom">
                                      <span class="input-group-addon" ng-click="openFrom()">
                                        <span class="glyphicon glyphicon-calendar">
                                        </span>
                                      </span>
                                    </input>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <label class="col-xs-2 col-xs-offset-2 control-label" for="dobToInput">{{ 'locale.inputLabels.dateOfBirthTo' | i18n }}</label>
                                  <div class="date col-xs-6 input-group" id="dobToPicker">
                                    <input readonly="readonly" type="text" name="dobTo" id="dobToInput" class="form-control" ng-blur="updateDobTo()" aria-describedby="dobAddon" ng-model="query.dob.to" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popupTo.opened" datepicker-options="dateOptionsTo">
                                      <span class="input-group-addon" ng-click="openTo()">
                                        <span class="glyphicon glyphicon-calendar">
                                        </span>
                                      </span>
                                    </input>
                                  </div>
                                </div>

                                <div class ="form-group">
                                  <label class ="col-xs-2 col-xs-offset-2 control-label" for="genderSelect">{{ 'locale.inputLabels.gender' | i18n }}</label>
                                  <div class="col-xs-6">
                                    <select name="gender" id="genderSelect" class="form-control" aria-describedby="genderAddon" ng-model="query.gender">
                                      <option ng-repeat="(key, value) in locale.gender" value="{{value}}">{{value}}</option>
                                    </select>
                                  </div>
                                </div>

                                <div class="form-group">
                                  <div ng-class="{ 'has-error': patientSearchForm.motherGivenName.$invalid &amp;&amp; (patientSearchForm.motherGivenName.$touched||patientSearchForm.$submitted)}">
                                    <label class="col-xs-2 col-xs-offset-2 control-label" for="motherGivenNameInput">{{ 'locale.inputLabels.motherGivenName' | i18n }}</label>
                                    <div class="col-xs-6">
                                      <input type="text" name="motherGivenName" id="motherGivenNameInput" ng-model="query.mother.given" ng-maxlength="50" class="form-control" placeholder="{{ 'locale.placeHolders.motherGivenName' | i18n }}" aria-describedby="motherGivenNameAddon" />
                                    </div>
                                  </div>
                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientSearchForm.motherGivenName.$error" role="alert" ng-if="patientSearchForm.motherGivenName.$touched||patientSearchForm.$submitted">
                                    <div ng-message="maxlength" class="alert alert-danger">{{ 'locale.errors.fieldLong' | i18n }}</div>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <div ng-class="{ 'has-error': patientSearchForm.motherFamilyName.$invalid &amp;&amp; (patientSearchForm.motherFamilyName.$touched||patientSearchForm.$submitted)}">
                                    <label class ="col-xs-2 col-xs-offset-2 control-label" for="motherFamilyNameInput">{{ 'locale.inputLabels.motherFamilyName' | i18n }}</label>
                                    <div class="col-xs-6">
                                      <input type="text" name="motherFamilyName" id="motherFamilyNameInput" ng-model="query.mother.family" ng-maxlength="50" class="form-control" placeholder="{{ 'locale.placeHolders.motherFamilyName' | i18n }}" aria-describedby="motherFamilyNameAddon" />
                                    </div>
                                  </div>
                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientSearchForm.motherFamilyName.$error" ng-if="patientSearchForm.motherFamilyName.$touched||patientSearchForm.$submitted" role="alert">
                                    <div ng-message="maxlength" class="alert alert-danger">{{ 'locale.errors.fieldLong' | i18n }}</div>
                                  </div>
                                </div>
                              </fieldset>
                            </div>
                          </div>
                        </div>

                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h3 class="panel-title text-center">
                              <a data-toggle="collapse" href="#additionalCriteriaCollapse">{{ 'locale.panelLabels.additionalSearchCriteria' | i18n }}</a>
                            </h3>
                          </div>
                          <div id="additionalCriteriaCollapse" class="panel-collapse collapse">
                            <div class="panel-body">
                              <fieldset class="form-horizontal">

                                <div class="form-group">
                                  <div ng-class="{ 'has-error': patientSearchForm.city.$invalid &amp;&amp; (patientSearchForm.city.$touched||patientSearchForm.$submitted)}">
                                    <label class="col-xs-2 col-xs-offset-2 control-label" id="cityInput">{{ 'locale.inputLabels.cityVillage' | i18n }}</label>
                                    <div class="col-xs-6">
                                      <input type="text" name="city" ng-maxlength="50" id="cityInput" ng-model="cityInput" class="form-control" placeholder="{{ 'locale.placeHolders.cityVillage' | i18n }}" aria-describedby="cityAddon" />
                                    </div>
                                    <div class="col-xs-offset-2 col-xs-9" ng-messages="patientSearchForm.city.$error" role="alert" ng-if="patientSearchForm.city.$touched||patientSearchForm.$submitted">
                                      <div ng-message="maxlength" class="alert alert-danger">{{ 'locale.errors.fieldLong' | i18n }}</div>
                                    </div>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <label class="col-xs-2 col-xs-offset-2 control-label" for="healthFacilityInput">{{ 'locale.inputLabels.healthFacility' | i18n }}</label>
                                  <div class ="col-xs-6">
                                    <input type="text" name="healthFacility" id="healthFacilityInput" ng-model="healthFacilityInput" class="form-control" placeholder="{{ 'locale.placeHolders.healthFacility' | i18n }}" aria-describedby="healthFacilityAddon" />
                                  </div>
                                </div>
                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="btn-group pull-right">
                        <button type="submit" class="btn btn-danger" ng-click="cancel()">
                          <span class="glyphicon glyphicon-remove"></span>
                          {{ 'locale.buttonLabels.cancel' | i18n }}
                        </button>
                        <button type="submit" class="btn btn-primary">
                          <span class="glyphicon glyphicon-search"></span> {{ 'locale.buttonLabels.search' | i18n }}

                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="panel panel-default" ng-if="searchResults">
                <div class="panel-heading">
                  <h4 class="panel-title">
                    {{ 'locale.tableHeaders.results' | i18n }}
                  </h4>
                </div>
                <!-- #include virtual="patientSearchResultTable" -->
                <div class="panel-body" ng-if="searchResults">
                  <div class="btn-group pull-right">
                    <button class="btn btn-danger" ng-click="cancel()">
                      <span class="glyphicon glyphicon-remove"></span>
                      {{ 'locale.buttonLabels.cancel' | i18n }}
                    </button>
                    <button ng-click="searchAgain()" class="btn btn-default">
                      <span class="glyphicon glyphicon-filter"></span> {{ 'locale.buttonLabels.searchAgain' | i18n }}
                    </button>
                    <a href="patientRegister" class="btn btn-primary ">
                      <span class="glyphicon glyphicon-plus-sign"></span> {{ 'locale.buttonLabels.patientRegister' | i18n }}
                    </a>
                  </div>
                </div>
                <div class="modal fade" id="myModal" role="dialog">
                  <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h4 class="modal-title">{{ 'locale.modalHeaders.checkInPatient' | i18n }}</h4>
                      </div>
                      <div class="modal-body">
                        <p>{{ 'locale.modalText.nextAppointment + modalPatient.Appointment' | i18n }}</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-right" ng-click="modalPatient.CheckedIn = !modalPatient.CheckedIn; setPatient()" data-dismiss="modal">
                          <span ng-if="!modalPatient.CheckedIn">{{ 'locale.buttonLabels.checkIn' | i18n }}</span>
                          <span ng-if="modalPatient.CheckedIn">{{ 'locale.buttonLabels.checkOut' | i18n }}</span>
                        </button>
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">{{ 'locale.buttonLabels.close' | i18n }}</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="patientRegister" mimeType="text/html">
    <contentHtml>
      <title lang="en">Regsiter Child</title>
      <title lang="sw">Saji Mtoto</title>
      <!-- absolute reference to the layout -->
      <layout>app://openiz.org/applet/org.timr.applet.layout/layout</layout>
      <script>app://openiz.org/asset/js/moment.min.js</script>
      <bundle>select2</bundle>
      <script>app://openiz.org/asset/js/bootstrap-datetimepicker.min.js</script>
      <script>patient-register-controller</script>
      <content>
        <div class="row" ng-controller="PatientRegisterController" xmlns="http://www.w3.org/1999/xhtml">
          <div class="container">
            <div class="row">
              <div class="col-xs-12">
                <form name="patientRegisterForm" role="form" novalidate="novalidate" ng-submit="register(patientRegisterForm.$invalid)">
                  <div class="panel-group">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">
                          <a data-toggle="collapse" href="#demoInfoCollapse">{{ 'locale.panelLabels.patientDemographicCriteria' | i18n }}</a>
                        </h3>
                      </div>
                      <div id="demoInfoCollapse" class="panel-collapse collapse in">
                        <div class="panel-body">
                          <div class="row">
                            <div class="col-xs-12">
                              <fieldset class="form-horizontal form-group">

                                <div ng-repeat="firstName in patient.patientNames.givenNames track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['givenName-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['givenName-' + $index].$invalid }">

                                    <label class="col-xs-2 control-label" for="givenNameInput">{{ 'locale.inputLabels.givenName' | i18n }}</label>

                                    <div class="col-xs-9 input-group">
                                      <input type="text" name="givenName-{{ $index }}" ng-model="patient.patientNames.givenNames[$index]" class="form-control" placeholder="{{ 'locale.placeHolders.givenName' | i18n }}" id="givenNameInput" />

                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('patientNames', 'givenNames', '')">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'patientNames', 'givenNames')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['givenName-' + $index].$error" ng-if="patientRegisterForm['givenName-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.givenNameRequired' | i18n }}</p>
                                  </div>
                                </div>

                                <div ng-repeat="lastName in patient.patientNames.familyNames track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['familyName-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['familyName-' + $index].$invalid }">

                                    <label class="col-xs-2 control-label" for="familyNameInput">{{ 'locale.inputLabels.familyName' | i18n }}</label>
                                    <div class="col-xs-9 input-group">

                                      <input type="text" name="familyName-{{ $index }}" ng-model="patient.patientNames.familyNames[$index]" class="form-control" placeholder="{{ 'locale.placeHolders.familyName' | i18n }}" id="familyNameInput"  />

                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('patientNames', 'familyNames', '')">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'patientNames', 'familyNames')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['familyName-' + $index].$error" ng-if="patientRegisterForm['familyName-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.familyNameRequired' | i18n }}</p>
                                  </div>
                                </div>

                                <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['dob'].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['dob'].$invalid }">
                                  <label class="col-xs-2 control-label" for="dobInput">{{ 'locale.inputLabels.dateOfBirth' | i18n }}</label>
                                  <div class="col-xs-9 input-group">
                                    <div class="input-group date">
                                      <input required="required" readonly="readonly" type="text" name="date" id="dobInput" class="form-control" ng-model="patient.dob.date" uib-datepicker-popup="dd/MMMM/yyyy" is-open="popupDOB.opened" datepicker-options="dateOptions">
                                        <span class="input-group-addon addon-background" ng-click="openDOB()">
                                          <span class="glyphicon glyphicon-calendar">
                                          </span>
                                        </span>
                                      </input>

                                      <span class="input-group-addon addon-background" id="accuracyAddon">{{ 'locale.inputLabels.accuracy' | i18n }}</span>

                                      <select name="accuracy" ng-model="patient.dob.accuracy" class="form-control" aria-describedby="accuracyAddon">
                                        <option value="4">{{ 'locale.accuracy.year' | i18n }}</option>
                                        <option value="7">{{ 'locale.accuracy.month' | i18n }}</option>
                                        <option value="10">{{ 'locale.accuracy.day' | i18n }}</option>
                                      </select>
                                    </div>
                                  </div>

                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['dob-' + $index].$error" ng-if="patientRegisterForm['dob-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p  class="alert alert-danger" ng-message="required">{{ 'locale.errors.dob' | i18n }}</p>
                                  </div>
                                </div>

                                <div class="form-group">
                                  <label class="col-xs-2 control-label" id="genderAddon">{{ 'locale.inputLabels.gender' | i18n }}</label>
                                  <div class="col-xs-9 input-group">
                                    <select id="genderSelect" ng-change="searchForDuplicates()" name="gender" ng-model="patient.gender" class="form-control" aria-describedby="genderAddon" required="required" >
                                    </select>
                                  </div>
                                </div>


                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="panel-heading" ng-if="searchResults">
                        <h3 class="panel-title">
                          <a data-toggle="collapse" href="#potentialDupCollapse">{{ 'locale.panelLabels.potentialDuplicates' | i18n }}</a>
                        </h3>
                      </div>
                      <!-- #include virtual="patientSearchResultTable" -->
                    </div>

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">
                          <a data-toggle="collapse" href="#identityCollapse">{{ 'locale.panelLabels.identification' | i18n }}</a>
                        </h3>
                      </div>
                      <div id="identityCollapse" class="panel-collapse collapse in">
                        <div class="panel-body">
                          <div class="row">
                            <div class="col-xs-12">
                              <fieldset class="form-horizontal form-group">
                                <div ng-repeat="identifier in patient.identifiers track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['identifierNum-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['identifierNum-' + $index].$invalid }">
                                    <label class="col-xs-2 control-label" id="idNumInput">{{ 'locale.inputLabels.id' | i18n }}</label>
                                    <div class="col-xs-9 input-group">
                                      <input type="text" name="identifierNum-{{ $index }}" ng-model=" patient.identifiers[$index].identifierNum" class="form-control" placeholder="646465786868576" id="idNumInput"  />
                                      <div class="input-group-btn">
                                        <button class="btn btn-default" type="button">
                                          <span class="glyphicon glyphicon-barcode"></span>
                                          {{ 'locale.buttonLabels.scan' | i18n }}
                                        </button>
                                      </div>
                                      <select name="identifierType-{{ $index }}" ng-model="patient.identifiers[$index].identifierType" class="form-control">
                                        <option ng-repeat="(key, value) in locale.identificationTypes" value="{{value}}">{{value}}</option>
                                      </select>
                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('identifiers', '', {identifierNum: '', identifierType: ''})">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'identifiers', '')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['identifierNum-' + $index].$error" ng-if="patientRegisterForm['identifierNum-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.idRequired' | i18n }}</p>
                                  </div>
                                </div>
                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">
                          <a data-toggle="collapse" href="#domicileCollapse">{{ 'locale.panelLabels.domicile' | i18n }}</a>
                        </h3>
                      </div>
                      <div id="domicileCollapse" class="panel-collapse collapse in">
                        <div class="panel-body">
                          <div class="row">
                            <div class="col-xs-12">
                              <fieldset class="form-horizontal form-group">
                                <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['cityOrVillage'].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['cityOrVillage'].$invalid }">
                                  <label class="col-xs-2 control-label" for="cityOrVillageInput">{{ 'locale.inputLabels.cityVillage' | i18n }}</label>
                                  <div class="col-xs-9 input-group">
                                    <input type="text" ng-maxlength="50" name="cityOrVillage" ng-model="patient.birthPlace.cityOrVillage" class="form-control" id="cityOrVillageInput" placeholder="{{ 'locale.inputLabels.cityVillage' | i18n }}" />
                                  </div>
                                </div>
                                <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['cityOrVillage'].$error" ng-if="patientRegisterForm['cityOrVillage'].$touched||patientRegisterForm.$submitted">
                                  <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.cityOrVillageRequired' | i18n }}</p>
                                  <p ng-message="maxlength" class="alert alert-danger">{{ 'locale.errors.fieldLong' | i18n }}</p>
                                </div>
                                <div class="form-group">
                                  <label class="col-xs-2 control-label" for="hospitalSelect">{{ 'locale.inputLabels.birthPlace' | i18n }}</label>
                                  <div class="col-xs-9 input-group">
                                    <select name="hospital" ng-model="patient.birthPlace.hospital" class="form-control" id="hospitalSelect">
                                      <option ng-repeat="(key, value) in locale.hospitals" value="{{value}}">{{value}}</option>
                                    </select>
                                  </div>
                                </div>
                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">
                          <a data-toggle="collapse" href="#contactCollapse">{{ 'locale.panelLabels.contactInformation' | i18n }}</a>
                        </h3>
                      </div>
                      <div id="contactCollapse" class="panel-collapse collapse in">
                        <div class="panel-body">
                          <div class="row">
                            <div class="col-xs-12">
                              <fieldset class="form-horizontal form-group">

                                <div ng-repeat="givenName in patient.contactNames.givenNames track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['contactGivenName-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['contactGivenName-' + $index].$invalid }">
                                    <label class="col-xs-2 control-label" for="contactGivenNameInput">{{ 'locale.inputLabels.givenName' | i18n }}</label>
                                    <div class="col-xs-9 input-group">

                                      <input type="text" name="contactGivenName-{{ $index }}" ng-model="patient.contactNames.givenNames[$index]" class="form-control" placeholder="{{ 'locale.placeHolders.givenName' | i18n }}" id="contactGivenNameInput" />
                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('contactNames', 'givenNames', '')">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'contactNames', 'givenNames')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['contactGivenName-' + $index].$error" ng-if="patientRegisterForm['contactGivenName-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.givenNameRequired' | i18n }}</p>
                                  </div>
                                </div>

                                <div ng-repeat="familyName in patient.contactNames.familyNames track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['contactFamilyName-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['contactFamilyName-' + $index].$invalid }">
                                    <label class="col-xs-2 control-label" id="contactFamilyNameInput">{{ 'locale.inputLabels.familyName' | i18n }}</label>

                                    <div class="col-xs-9 input-group">

                                      <input type="text" name="contactFamilyName-{{ $index }}" ng-model="patient.contactNames.familyNames[$index]" class="form-control" placeholder="{{ 'locale.placeHolders.familyName' | i18n }}" aria-describedby="contactFamilyNameAddon"  />
                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('contactNames', 'familyNames', '')">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'contactNames', 'familyNames')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['contactFamilyName-' + $index].$error" ng-if="patientRegisterForm['contactFamilyName-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.familyNameRequired' | i18n }}</p>
                                  </div>
                                </div>

                                <div ng-repeat="contactNumber in patient.contactPhones track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['phoneNum-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['phoneNum-' + $index].$invalid }">
                                    <label class="col-xs-2 control-label" for="phoneNumInput">{{ 'locale.inputLabels.telephone' | i18n }}</label>
                                    <div class="col-xs-9 input-group">

                                      <input type="text" name="phoneNum-{{ $index }}" ng-model="patient.contactPhones[$index].phoneNum" class="form-control" placeholder="465432345689976533" id="phoneNumInput"  />
                                      <span class="input-group-addon addon-background" id="phoneTypeAddon">
                                        <span class="glyphicon glyphicon-earphone"></span>
                                      </span>
                                      <select name="phoneType-{{ $index }}" ng-model="patient.contactPhones[$index].phoneType" class="form-control" aria-describedby="phoneTypeAddon">
                                        <option ng-repeat="(key, value) in locale.phone" value="{{value}}">{{value}}</option>
                                      </select>
                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('contactPhones', '', {phoneNum: '', phoneType: ''})">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'contactPhones', '')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['phoneNum-' + $index].$error" ng-if="patientRegisterForm['phoneNum-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.telephoneRequired' | i18n }}</p>
                                    <p class="alert alert-danger" ng-message="phone">{{ 'locale.errors.telephone' | i18n }}</p>
                                  </div>
                                </div>

                                <div ng-repeat="contactEmail in patient.contactEmails track by $index">
                                  <div class="form-group" ng-class="{ 'has-error': (patientRegisterForm['email-' + $index].$touched||patientRegisterForm.$submitted) &amp;&amp; patientRegisterForm['email-' + $index].$invalid }">
                                    <label class="col-xs-2 control-label" for="emailInput">{{ 'locale.inputLabels.email' | i18n }}</label>
                                    <div class="col-xs-9 input-group">
                                      <input type="email" name="email-{{ $index }}" ng-model="patient.contactEmails[$index].email" class="form-control" placeholder="{{ 'locale.placeHolders.email' | i18n }}" id="emailInput"  />

                                      <span class="input-group-addon addon-background" id="domainAddon">@</span>
                                      <select name="domainType" ng-model="patient.contactEmails[$index].domainType" id="domainSelect" class="form-control" aria-describedby="domainAddon">
                                        <option ng-repeat="(key, value) in locale.domainTypes" value="{{value}}">{{value}}</option>
                                      </select>
                                      <div class="input-group-btn">
                                        <button class="btn btn-default btn-custom" type="button" ng-click="add('contactEmails', '', {email: '', domainType: ''})">
                                          <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button class="btn btn-default btn-custom" type="button" ng-click="remove($index, 'contactEmails', '')">
                                          <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="col-xs-offset-2 col-xs-9" ng-messages="patientRegisterForm['email-' + $index].$error" ng-if="patientRegisterForm['email-' + $index].$touched||patientRegisterForm.$submitted">
                                    <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.emailRequired' | i18n }}</p>
                                    <p class="alert alert-danger" ng-message="email">{{ 'locale.errors.email' | i18n }}</p>
                                  </div>
                                </div>

                                <div class="form-group">
                                  <label class="col-xs-2 control-label" for="relationTypeInput">{{ 'locale.inputLabels.relationshipToPatient' | i18n }}</label>
                                  <div class="col-xs-9 input-group">
                                    <select name="relationshipType" ng-model="patient.contactRelationship" class="form-control" id="relationshipTypeSelect"  >
                                    </select>
                                  </div>
                                </div>
                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">
                          {{ 'locale.panelLabels.additionalInfo' | i18n }}
                        </h3>
                      </div>
                      <div class="panel-body">
                        <div class="form-group">
                          <div class="checkbox">
                            <label for="tetanusCheck">
                              <input type="checkbox" ng-model="patient.tetanusStatus" name="tetanusStatus" id="tetanusCheck" /> {{ 'locale.checkLabels.tetanusDiagnosis' | i18n }}
                            </label>
                          </div>
                          <div class="checkbox">
                            <label for="breastFeedingCheck">
                              <input type="checkbox" ng-model="patient.breastFeedingStatus" name="breastFeedingStatus" id="breastFeedingCheck" /> {{ 'locale.checkLabels.breastfeedingStatus' | i18n }}
                            </label>
                          </div>
                          <div class="checkbox">
                            <label for="birthCertCheck">
                              <input type="checkbox" ng-model="patient.birthCertificateStatus" name="birthCertificateStatus" id="birthCertCheck" /> {{ 'locale.checkLabels.birthCertificate' | i18n }}
                            </label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <button type="submit" ng-click="printPatient()" class="btn btn-primary pull-right">{{ 'locale.buttonLabels.register' | i18n }}</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="patient-admin-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
      layoutApp.controller('PatientAdministrationController', ['$scope', 'localize', function ($scope, localize)
		  {

      }]);

      ]]>
    </contentText>
  </asset>
  <asset name="patientView" mimeType="text/html">
    <contentHtml>
      <layout>app://openiz.org/applet/org.timr.applet.layout/patientLayout</layout>
      <script>patient-view-controller</script>
      <bundle>select2</bundle>
      <content>
        <div class="row" ng-controller="PatientViewController" xmlns="http://www.w3.org/1999/xhtml">
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active">
              <a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">{{ 'locale.tabHeaders.patientProfile' | i18n }}</a>
            </li>
            <li role="presentation">
              <a href="#history" aria-controls="history" role="tab" data-toggle="tab">{{ 'locale.tabHeaders.patientHistory' | i18n }}</a>
            </li>
            <li role="presentation">
              <a href="#weights" aria-controls="weights" role="tab" data-toggle="tab">{{ 'locale.tabHeaders.patientWeight' | i18n }}</a>
            </li>
            <li role="presentation">
              <a href="#vaccinations" aria-controls="vaccinations" role="tab" data-toggle="tab">{{ 'locale.tabHeaders.patientVaccination' | i18n }}</a>
            </li>
            <li role="presentation">
              <a href="#aefi" aria-controls="aefi" role="tab" data-toggle="tab">{{ 'locale.tabHeaders.patientAefi' | i18n }}</a>
            </li>
          </ul>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="profile">
              profile tab
            </div>
            <div role="tabpanel" class="tab-pane" id="history">
              history tab
            </div>
            <div role="tabpanel" class="tab-pane" id="vaccinations">
              <div class="row">
                <div class="col-md-12">
                  <!-- #include virtual="vaccinationEncounter" -->
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="weights">
              <!-- #include virtual="weightEncounter" -->
            </div>
            <div role="tabpanel" class="tab-pane" id="aefi">
              <!-- #include virtual="aefi" -->
            </div>

          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="aefi" mimeType="text/html">
    <contentHtml>
      <script>aefi-controller</script>
      <content lang="en">
        <div ng-controller="AefiController" xmlns="http://www.w3.org/1999/xhtml">
          <div class="row">
            <div class="col-md-12">
              <div class="panel panel-default">
                <div class="panel panel-heading">
                  <h3 class="panel-title">
                    <a data-toggle="collapse" href="#recordAefi">Record AEFI</a>
                    <a data-toggle="collapse" href="#recordAefi">
                      <span class="glyphicon glyphicon-chevron-down pull-right"></span>
                    </a>
                  </h3>
                </div>
                <div class="panel panel-body">
                  <form novalidate="novalidate" name="aefiForm">
                    <div class="panel panel-body">
                      <div class="row">
                        <div class="col-md-12">

                          <div class="form-group">
                            <div class="col-md-3">
                              <label class="control-label" for="startDateInput">{{ 'locale.inputLabels.startDate' | i18n }}</label>
                              <input type="text" name="startDate" id="startDateInput" class="form-control" aria-describedby="startDateAddon" ng-model="startDate" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popup.opened" datepicker-options="dateOptions" required="required" />
                              <span class="input-group-addon" ng-click="openDate()">
                                <span class="glyphicon glyphicon-calendar">
                                </span>
                              </span>
                              <div ng-messages="aefiForm['startDate'].$error" ng-if="aefiForm['startDate'].$touched || aefiForm.$submitted">
                                <span class="help-block text-danger" ng-message="required">{{ 'locale.errors.startDateRequired' | i18n }}</span>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <label class="control-label" for="stopDateInput">{{ 'locale.inputLabels.stopDate' | i18n }}</label>
                              <input type="datetime" id="stopDateInput" name="stopDate" class="form-control" ng-model="stopDate" aria-describedby="stopDateAddon" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popup.opened" datepicker-options="dateOptions" />
                              <span class="input-group-addon" ng-click="openDate()">
                                <span class="glyphicon glyphicon-calendar">
                                </span>
                              </span>
                            </div>
                            <div class="col-md-3">
                              <label class="control-label" for="onsetLatencyInput">{{ 'locale.inputLabels.onsetLatency' | i18n }}</label>
                              <input type="text" id="onsetLatencyInput" name="onsetLatency" class="form-control" ng-model="onsetLatency" />
                              <div ng-messages="aefiForm['onsetLatency'].$error" ng-if="aefiForm['onsetLatency'].$touched || aefiForm.$submitted">
                                <span class="help-block text-danger" ng-message="required">{{ 'locale.errors.onsetLatencyRequired' | i18n }}</span>
                              </div>
                            </div>
                          </div>

                          <div class="form-group" ng-class="{ 'has-error': (aefiForm['adverseReactionDescription'].$touched||aefiForm.$submitted) &amp;&amp; aefiForm['adverseReactionDescription'].$invalid }">
                            <div class="col-md-12">
                              <label class="control-label" for="adverseReactionDescriptionInput">{{ 'locale.inputLabels.adverseReactionDescription' | i18n }}</label>
                              <textarea id="adverseReactionDescriptionInput" name="adverseReactionDescription" class="form-control" rows="5" ng-model="adverseReactionDescription" ng-required="true"></textarea>
                              <div ng-messages="aefiForm['adverseReactionDescription'].$error" ng-if="aefiForm['adverseReactionDescription'].$touched || aefiForm.$submitted">
                                <span class="help-block text-danger" ng-message="required">{{ 'locale.errors.descriptionRequired' | i18n }}</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="panel panel-body">
                      <div class="form-group">
                        <label class="control-label" for="reactionSubsidedInput">{{ 'locale.inputLabels.reactionSubsided' | i18n }}</label>
                        <label class="radio-inline">
                          <input type="radio" name="reactionSubsidedRadio" id="reactionSubsidedYes" value="yes" />{{ 'locale.inputLabels.yes' | i18n }}
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="reactionSubsidedRadio" id="reactionSubsidedNo" value="No" />{{ 'locale.inputLabels.no' | i18n }}
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="reactionSubsidedRadio" id="reactionSubsidedUnknown" value="Unknown" />{{ 'locale.inputLabels.unknown' | i18n }}
                        </label>
                      </div>

                      <div class="form-group">
                        <label class="control-label" for="reactionReappearedInput">{{ 'locale.inputLabels.reactionReappeared' | i18n }}</label>
                        <label class="radio-inline">
                          <input type="radio" name="reactionReappearedRadio" id="reactionReappearedYes" value="yes" />{{ 'locale.inputLabels.yes' | i18n }}
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="reactionReappearedRadio" id="reactionReappearedNo" value="No" />{{ 'locale.inputLabels.no' | i18n }}
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="reactionReappearedRadio" id="reactionReappearedUnknown" value="NotApplicable" />{{ 'locale.inputLabels.notApplicable' | i18n }}
                        </label>
                      </div>

                      <div class="form-group">

                        <div class="row">
                          <div class="col-md-12">
                            <div class="form-group pull-left">
                              <label class="control-label" for="seriousnessOfReactionInput">{{ 'locale.inputLabels.seriousnessOfReaction' | i18n }}</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="form-group">

                        <div class="row">
                          <div class="col-md-12">
                            <div class="col-md-6">
                              <div class="form-group">
                                <div class="checkbox">
                                  <input type="checkbox" id="seriousnessOfReactionDiscomfortAbleInput" name="seriousnessOfReactionDiscomfortAble" />{{ 'locale.inputLabels.discomfortAbleToWork' | i18n }}
                                </div>
                                <div class="checkbox">
                                  <input type="checkbox" id="seriousnessOfReactionDiscomfortUnableInput" name="seriousnessOfReactionDiscomfortUnable" />{{ 'locale.inputLabels.discomfortUnableToWork' | i18n }}
                                </div>
                                <div class="checkbox">
                                  <input type="checkbox" id="requiredHospitalizationInput" name="requiredHospitalization" />{{ 'locale.inputLabels.requiredHospitalization' | i18n }}
                                </div>
                                <div class="checkbox">
                                  <input type="checkbox" id="lifeThreateningInput" name="lifeThreatening" />{{ 'locale.inputLabels.lifeThreatening' | i18n }}
                                </div>
                              </div>
                            </div>

                            <div class="col-md-6">
                              <div class="form-group">
                                <div class="checkbox">
                                  <input type="checkbox" id="persistentDisabilityInput" name="persistentDisability" />{{ 'locale.inputLabels.persistentDisability' | i18n }}
                                </div>
                                <div class="checkbox">
                                  <input type="checkbox" id="congenitalAnomalyInput" name="congenitalAnomaly" />{{ 'locale.inputLabels.congenitalAnomaly' | i18n }}
                                </div>
                                <div class="checkbox">
                                  <input type="checkbox" id="patientDiedInput" name="patientDied" />{{ 'locale.inputLabels.patientDied' | i18n }}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="form-group">
                        <div class="row">
                          <div class="col-md-12">
                            <div class="form-group">
                              <div class="col-md-8">
                                <button type="submit" class="btn btn-primary pull-right">{{ 'locale.buttonLabels.save' | i18n }}</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="vaccinationEncounter" mimeType="text/html">
    <contentHtml>
      <script>vaccination-controller</script>
      <content lang="en">
        <div ng-controller="VaccinationController" xmlns="http://www.w3.org/1999/xhtml">
          <div class="row">
            <div class="col-md-12">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">
                    <a data-toggle="collapse" href="#enterVaccination">{{ 'locale.panelLabels.enterVaccination' | i18n }}</a>
                    <a data-toggle="collapse" href="#enterVaccination">
                      <span class="glyphicon glyphicon-chevron-down pull-right"></span>
                    </a>
                  </h3>
                </div>
                <div class="panel-body" id="enterVaccination">
                  <form novalidate="novalidate" name="vaccinationForm">
                    <fieldset>

                      <div class="row">
                        <div class="col-md-12">
                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="dateOfVaccinationInput">{{ 'locale.inputLabels.dateOfVaccination' | i18n }}</label>
                                <input type="text" name="dateOfVaccination" id="dateOfVaccinationInput" class="form-control" aria-describedby="dateOfVaccinationAddon" ng-model="dateOfVaccination" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popup.opened" datepicker-options="dateOptions" required="required" />
                                <span class="input-group-addon" ng-click="openDate()">
                                  <span class="glyphicon glyphicon-calendar">
                                  </span>
                                </span>
                                <div ng-messages="vaccinationForm['dateOfVaccination'].$error" ng-if="vaccinationForm['dateOfVaccination'].$touched || vaccinationForm.$submitted">
                                  <div class="text-center alert alert-danger" ng-message="required">{{ 'locale.errors.dateOfVaccinationRequired' | i18n }}</div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="locationInput">{{ 'locale.inputLabels.location' | i18n }}</label>
                                <select id="locationInput" name="location" class="form-control" ng-model="location">
                                  <option value="">{{ 'locale.inputLabels.select' | i18n }}</option>
                                  <option value="OPV-0">OPV-0</option>
                                  <option value="OPV-1">OPV-1</option>
                                  <option value="OPV-2">OPV-2</option>
                                  <option value="BCG">BCG</option>
                                </select>
                              </div>
                              <div ng-messages="vaccinationForm['location'].$error" ng-if="vaccinationForm['location'].$touched || vaccinationForm.$submitted">
                                <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.locationRequired' | i18n }}</p>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="vaccineInput">{{ 'locale.inputLabels.vaccine' | i18n }}</label>
                                <select id="vaccineInput" name="vaccine" class="form-control" ng-model="vaccine">
                                  <option value="">{{ 'locale.inputLabels.select' | i18n }}</option>
                                  <option value="OPV-0">OPV-0</option>
                                  <option value="OPV-1">OPV-1</option>
                                  <option value="OPV-2">OPV-2</option>
                                  <option value="BCG">BCG</option>
                                </select>
                              </div>
                              <div ng-messages="vaccinationForm['vaccine'].$error" ng-if="vaccinationForm['vaccine'].$touched || vaccinationForm.$submitted">
                                <div class="text-center alert alert-danger" ng-message="required">{{ 'locale.errors.vaccinationRequired' | i18n }}</div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <div ng-class="{ 'has-error': (vaccinationForm.dose.$touched||vaccinationForm.$submitted) &amp;&amp; vaccinationForm.dose.$invalid }">
                                  <label class="control-label" for="doseInput">{{ 'locale.inputLabels.dose' | i18n }}</label>
                                  <input id="doseInput" name="dose" type="text" placeholder="{{ 'locale.placeholders.dose' | i18n }}" class="form-control" ng-model="dose" ng-required="true"/>
                                </div>
                                <div ng-messages="vaccinationForm['dose'].$error" ng-if="vaccinationForm['dose'].$touched||vaccinationForm.$submitted">
                                  <p class="alert alert-danger" ng-message="required">{{ 'locale.errors.doseRequired' | i18n }}</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-12">

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="routeInput">{{ 'locale.inputLabels.route' | i18n }}</label>
                                <select id="routeInput" name="route" class="form-control">
                                  <option value="">{{ 'locale.inputLabels.select' | i18n }}</option>
                                  <option value="Injection">{{ 'locale.inputLabels.injection' | i18n }}</option>
                                  <option value="Oral">{{ 'locale.inputLabels.oral' | i18n }}</option>
                                </select>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="unitInput">{{ 'locale.inputLabels.unit' | i18n }}</label>
                                <select id="unitInput" name="unit" class="form-control">
                                  <option value="">{{ 'locale.inputLabels.select' | i18n }}</option>
                                  <option value="mL">Millilitres</option>
                                  <option value="L">Litres</option>
                                </select>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="lotNoInput">{{ 'locale.inputLabels.lotNo' | i18n }}</label>
                                <select id="lotNoInput" name="lotNo" class="form-control">
                                  <option value="">{{ 'locale.inputLabels.select' | i18n }}</option>
                                  <option value="123048234">123048234</option>
                                  <option value="213480934">213480934</option>
                                  <option value="09485650">09485650</option>
                                  <option value="0956795678">0956795678</option>
                                </select>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="manufacturerInput">{{ 'locale.inputLabels.manufacturer' | i18n }}</label>
                                <select id="manufacturerInput" name="manufacturer" class="form-control">
                                  <option value="">{{ 'locale.inputLabels.select' | i18n }}</option>
                                  <option value="GSK">GSK</option>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <div class="col-md-6">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class="control-label" for="commentsInput">{{ 'locale.inputLabels.comments' | i18n }}</label>
                                <textarea id="commentsInput" name="comments" type="text" placeholder="{{ 'locale.placeholders.comments' | i18n }}" class="form-control" rows="5"></textarea>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group">
                            <div class="col-md-8">
                              <button type="submit" class="btn btn-primary pull-right">{{ 'locale.buttonLabels.save' | i18n }}</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </fieldset>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="weightEncounter" mimeType="text/html">
    <contentHtml>
      <script>weight-controller</script>
      <content lang="en">
        <div ng-controller="WeightController"  xmlns="http://www.w3.org/1999/xhtml">
          <div class="row">
            <div class="col-xs-12">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title text-center">{{ 'locale.panelLabels.newWeightEntry' | i18n }}</h3>
                </div>
                <div class="panel-body">
                  <fieldset class="form-horizontal">
                    <form name="weightEntryForm" novalidate="novalidate" ng-submit="checkWeightFields(weightEntryForm.$invalid)">
                      <div class="row">
                        <div class="col-md-12">

                          <div class="col-md-3">
                            <div class ="form-group">
                              <div class="col-md-8">
                                <div ng-class="{ 'has-error': weightEntryForm.weight.$invalid &amp;&amp; (weightEntryForm.weight.$touched||weightEntryForm.$submitted) }">
                                  <label class ="control-label" for="weightInput">{{ 'locale.inputLabels.weight' | i18n }}</label>
                                  <input type="number" name="weight" id="weightInput" class="form-control" aria-describedby="weightInputAddon" ng-model="patient.newWeight" required="required" />
                                  <div ng-messages="weightEntryForm.weight.$error" ng-if="weightEntryForm.weight.$touched||weightEntryForm.$submitted">
                                    <div class="text-center alert alert-danger" ng-message="required">{{ 'locale.errors.weightRequired' | i18n }}</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <div class="col-md-8">
                                <label class ="control-label" for="weightUnitSelect">{{ 'locale.inputLabels.unit' | i18n }}</label>
                                <select name="weightUnit" id="weightUnitSelect" class="form-control" aria-describedby="weightUnitAddon" ng-model="patient.newUnit" required="required">
                                  <option ng-repeat="(key, value) in locale.weightUnit" value="{{value}}">{{value}}</option>
                                </select>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                      <div class="form-group">
                        <button type="submit" class="col-xs-offset-10 btn btn-primary">
                          {{ 'locale.buttonLabels.save' | i18n }}
                        </button>
                      </div>
                    </form>
                    <div class="modal fade" id="myModal" role="dialog">
                      <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h4 class="modal-title">{{ 'locale.modalHeaders.confirmWeight' | i18n }}</h4>
                          </div>
                          <div class="modal-body">
                            <p>{{locale.modalText.updateWeight + patient.FirstName + "," + patient.LastName + locale.modalText.to + patient.newWeight + " " + patient.newUnit}}</p>
                            <p>{{ 'locale.modalText.isCorrect' | i18n }}</p>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-success pull-left" data-dismiss="modal">{{ 'locale.buttonLabels.yes' | i18n }}</button>
                            <button type="button" class="btn btn-danger pull-right" data-dismiss="modal">{{ 'locale.buttonLabels.no' | i18n }}</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <h4 class="text-center">
                      {{ 'locale.panelLabels.previousWeights' | i18n }}
                      <span class="menu-arrow-toggleable-weight-table glyphicon glyphicon-menu-down pull-right" data-toggle="collapse" href="#weightTableCollapse"></span>
                    </h4>
                    <div class="form-group collapse" id="weightTableCollapse">
                      <table class="table table-striped table-bordered">

                        <thead>
                          <tr>
                            <th>{{ 'locale.tableHeaders.dateRecorded' | i18n }}</th>
                            <th>{{ 'locale.tableHeaders.weight' | i18n }}</th>
                            <th>{{ 'locale.tableHeaders.unit' | i18n }}</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr ng-repeat="weights in weightRecords">
                            <td>{{weights.Date.getDate()+"/"+weights.Date.getMonth()+"/"+weights.Date.getFullYear()}}</td>
                            <td>{{weights.Weight}}</td>
                            <td>{{weights.unit}}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <div class="chart-container">
              <canvas id="weight-canvas" height="225" width="300"></canvas>
            </div>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="aefi-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
      layoutApp.controller('AefiController', ['$scope', function ($scope)
		  {
        $scope.remove = function(index, outerModelAccess, innerModelAccess)
        {
          if(index != 0)
          {
            if(innerModelAccess == "")
            {
              $scope.user[outerModelAccess].splice(index, 1);
            }
            else
            {
              $scope.user[outerModelAccess][innerModelAccess].splice(index, 1);
            }
          }
        };

          $scope.add = function(outerModelAccess, innerModelAccess, objToPush) {
            if(innerModelAccess == ""){
              $scope.user[outerModelAccess].push(objToPush);
            }
            else {
              $scope.user[outerModelAccess][innerModelAccess].push(objToPush);
            }
          };
          
          
          $scope.openDate = function() {
            $scope.popup.opened = true;
          };
          
          $scope.popup = {
            opened: false
          };
      }]);

      ]]>
    </contentText>
  </asset>
  <asset name="weight-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
      layoutApp.controller('WeightController', ['$scope', function ($scope)
		  {

         $scope.checkWeightFields = function(invalid) {
              if (!invalid)
              {
                $("#myModal").modal();
              }
              else
              {
                toastr.error($scope.locale.toastrText.invalidForm, $scope.locale.toastrHeaders.invalidForm);
              }
          };
         $scope.findWeights = function(){
            $scope.patient = JSON.parse(sessionStorage.getItem("Patient"));
            
            var today = new Date();
            var weightArray = [];
            console.log($scope.patient.DateOfBirth);
            var dateOfBirth = new Date($scope.patient.DateOfBirth);
            console.log(today);
            console.log(dateOfBirth);
            var age = today.getFullYear()-dateOfBirth.getFullYear();
            var finalWeight = Math.floor(Math.random(5000) + 3000);
            var increment = finalWeight/age;
            console.log(age);
            for(var i = 0; i<age; i++){
              var eachDate = new Date($scope.patient.DateOfBirth);
              eachDate.setFullYear(eachDate.getFullYear()+i);
              weightArray[i] = {Date: eachDate, Unit: "Kilograms", Weight: Math.floor(Math.random(increment)+increment*i)/100};
            }

              $scope.weightRecords = weightArray;
              $scope.draw();
         };

         $scope.openDate = function() {
          $scope.popup.opened = true;
         };
         $scope.popup = {
            opened: false
          };
          $scope.draw = function(){
              var labelsA = [];
              var dataA = [];

              for(var i = 0; i<$scope.weightRecords.length;i++){
                labelsA[i] = $scope.weightRecords[i].Date.getFullYear();
                dataA[i] = parseInt($scope.weightRecords[i].Weight);
              }

              var chartData = {
                labels: labelsA,
                datasets: [
                  {
                label: "My First dataset",
                fill: false,
                lineTension: 0.1,
                backgroundColor: "rgba(51,204,204,0.4)",
                borderColor: "rgba(51,204,204,1)",
                borderCapStyle: 'butt',
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: 'miter',
                pointBorderColor: "rgba(51,204,204,1)",
                pointBackgroundColor: "rgb(51,204,204)",
                pointBorderWidth: 1,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(51,204,204,1)",
                pointHoverBorderColor: "rgba(51,204,204,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                fillColor: "rgba(51,204,204,0.4)",
                strokeColor: "rgba(51,204,204,1)",
                pointColor: "rgba(31, 122, 122,1)",
                data: dataA,
                        }
                ]
            };

              var sctx = document.getElementById("weight-canvas").getContext("2d");
		          window.myLine = new Chart(sctx).Line(chartData, {
			          responsive: true
		          });

	        }
          $scope.findWeights();
          $scope.patient.newUnit = $scope.locale.weightUnit.kilograms;
          $scope.patient.dateTime = new Date();
           $scope.dateOptions = {
            formatYear: 'yy',
            maxDate: new Date(),
            minDate: new Date(1990, 1, 1)
         };

      }]);

      ]]>
    </contentText>
  </asset>
  <asset name="vaccination-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
      layoutApp.controller('VaccinationController', ['$scope', function ($scope)
		  {
          $scope.openDate = function() {
            $scope.popup.opened = true;
          };
          
          $scope.popup = {
            opened: false
          };
          
          $scope.doseRegex = '/\d+\.?\d*/';
          
          $scope.vaccination = new Object();
          $scope.vaccination.dateOfVaccination = new Date();
          
      }]);

      ]]>
    </contentText>
  </asset>
  <asset name="patient-search-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
		  layoutApp.controller('PatientSearchController', ['$scope', 'localize', function ($scope, localize)
		  {
        $scope.initialize = function() {
          $scope.datetimeFrom = new Date();
          $scope.datetimeTo = new Date();
          $scope.popupFrom = {
            opened: false
          };
          $scope.popupTo = {
            opened: false
          };
          $scope.dateOptionsFrom = {
            formatYear: 'yy',
            minDate: new Date(1990, 1, 1),
            maxDate: new Date()
          };

           $scope.dateOptionsTo = {
            formatYear: 'yy',
            minDate: new Date(1990, 1, 1),
            maxDate: new Date()
          };
          
          $scope.phoneRegex = '^\\d{3}-\\d{3}-\\d{4}$';
        };

        $scope.searchAgain = function() {
          $('#searchPanel').collapse('show');
          $scope.searchResults = null;
        };
        
        $scope.openFrom = function() {
          $scope.popupFrom.opened = true;
        };

         $scope.openTo = function() {
          $scope.popupTo.opened = true;
         };
                   
        $scope.updateDobTo = function(){
            $scope.dateOptionsFrom = {
              maxDate: new Date($scope.query.dob.to.getFullYear(), $scope.query.dob.to.getMonth(),  $scope.query.dob.to.getDate())
            };
        }
        
        $scope.updateDobFrom = function(){
            $scope.dateOptionsTo = {
              minDate: new Date($scope.query.dob.from.getFullYear(), $scope.query.dob.from.getMonth(),  $scope.query.dob.from.getDate())
            };
        }

        $scope.view = function(patient){
          window.location.href = "/applet/org.timr.applet.patientAdministration/patientView?pid=" + patient.id ;
        }
                
        $scope.scanBarcodeLink = function()
        {
          $scope.barcode = OpenIZ.App.scanBarcode(); //Once this is implemented
        }
        
        $scope.cancel = function()
        {
          window.history.back();
        }

        $scope.log = function(patient){
          console.log(patient);
        }
        
        $scope.search = function(invalid)
        {
          $('#waitDialog').modal('show');
          
          try
          {
            if(!invalid && $scope.query){
              var searchString = "_expand=name&_expand=address&_expand=gender";
              if($scope.query.identifiers)
                searchString += "&identifier.value=" + $scope.query.identifiers.value;
              if($scope.query.dob && $scope.query.dob.from)
                searchString += "&dateOfBirth=>" + OpenIZ.Util.toDateInputString($scope.query.dob.from);
              if($scope.query.dob && $scope.query.dob.to)
                searchString += "&dateOfBirth=<" + OpenIZ.Util.toDateInputString($scope.query.dob.to);
              if($scope.query.names && $scope.query.names.given)
                searchString += "&name.component[Given].value=" + $scope.query.names.given;
              if($scope.query.names && $scope.query.names.family)
                searchString += "&name.component[Family].value=" + $scope.query.names.family;
              if($scope.query.mother && $scope.query.mother.given)
                searchString += "&relationship.target.name[Given].value=" + $scope.query.mother.given;
              if($scope.query.mother && $scope.query.mother.family)
                searchString += "&relationship.target.name[Family].value=" + $scope.query.mother.given;
             
              // TODO: Update the URL so we can re-populate and run search results
            
                OpenIZ.Patient.findAsync(
                {
                  query: searchString,
                  continueWith: function(result)
                  {
                    $('#searchPanel').collapse('hide');
                    $('#waitDialog').modal('hide');
                   
                    $scope.$apply(function() { $scope.searchResults = result.all('Patient'); });
                    // TODO: Pagination and results
                  },
                  onException : function(ex) {
                    toastr.error(ex);
                    $('#waitDialog').modal('hide');
                  }
                }
              );
              
            }
            else{
              toastr.options = {"positionClass":"toast-top-center",
              "timeOut": 5000};
              toastr.error(localize.getString('locale.toastrText.invalidForm'), localize.getString('locale.toastrHeaders.invalidForm'));
            }
          }
          catch(ex)
          {
            toastr.error(ex); 
            $('#waitDialog').modal('hide');
            
          }
       }
       
       $scope.show = function(tab)
       {
        console.log(tab);
        $(tab).tab('show');
       }
        
        $scope.initialize();

      }]);

      ]]>
    </contentText>
  </asset>
  <asset name="patient-register-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[

		  layoutApp.controller('PatientRegisterController', ['$scope', 'localize', function ($scope ,localize)
		  {
        $scope.patient = {
          patientNames: {
            givenNames: [""],
            familyNames: [""]
          },
          dob: {
            date: new Date(),
            accuracy: 10
          },
          gender: "",
          identifiers: [{
            identifierNum: "",
            identifierType: ""
          }],
          tetanusStatus: false,
          breastFeedingStatus: false,
          birthCertificateStatus: false,
          birthPlace: {
            cityOrVillage: "",
            hospital: ""
          },
          contactNames: {
            givenNames: [""],
            familyNames: [""]
          },
          contactPhones: [{
            phoneNum: "",
            phoneType: ""
          }],
          contactEmails: [{
            email: "",
            domainType: ""
          }]
        };

        $scope.initialize = function() {
          OpenIZ.Concept.findConceptSetAsync({
            query: "mnemonic=ChildFamilyMember",
            continueWith: function(results) {
              var concepts = results.first("ConceptSet").toDisplayModel();
              var relationshipTypes = $("#relationshipTypeSelect").prop('options');
              $.each(concepts, function(id, val) {
                relationshipTypes[relationshipTypes.length] = new Option(val.text, val.id);
              });
              //$scope.$digest(function() { $scope.relationshipTypes = concepts; });
            }
          });
          OpenIZ.Concept.findConceptSetAsync({
            query: "mnemonic=AdministrativeGenderCode",
            continueWith: function(results) {
              var concepts = results.first("ConceptSet").toDisplayModel();
              var genderTypes = $("#genderSelect").prop('options');
              $.each(concepts, function(id, val) {
                genderTypes[genderTypes.length] = new Option(val.text, val.id);
              });
            }
          });
        };
 
         $scope.openDOB = function() {
          $scope.popupDOB.opened = true;
         };

         $scope.popupDOB = {
            opened: false
          };

          $scope.dateOptions = {
            formatYear: 'yy',
            maxDate: new Date(),
            minDate: new Date(1990, 1, 1),
            startingDay: 1
          };

        $scope.remove = function(index, outerModelAccess, innerModelAccess) {
          if(index != 0){
            if(innerModelAccess == "")
            {
               $scope.patient[outerModelAccess].splice(index, 1);
            }
            else
            {
               $scope.patient[outerModelAccess][innerModelAccess].splice(index, 1);
            }
          }
        };

        $scope.add = function(outerModelAccess, innerModelAccess, objToPush) {
          if(innerModelAccess == ""){
            $scope.patient[outerModelAccess].push(objToPush);
          }
          else {
            $scope.patient[outerModelAccess][innerModelAccess].push(objToPush);
          }
        };

        $scope.printPatient = function(){
          console.log($scope.patient);
        };

        $scope.searchForDuplicates = function()
        {
              var searchString = "_expand=name&_expand=address&_expand=gender";
              if($scope.patient.dob && $scope.patient.dob.date)
                searchString += "&dateOfBirth=~" + OpenIZ.Util.toDateInputString($scope.patient.dob.date).substring(0, $scope.patient.dob.accuracy);
              if($scope.patient.patientNames && 
                $scope.patient.patientNames.givenNames &&
                $scope.patient.patientNames.givenNames[0] != ""
              )
                searchString += "&name.component[Given].value=~" + $scope.patient.patientNames.givenNames[0];
              if($scope.patient.patientNames && 
                $scope.patient.patientNames.familyNames &&
                $scope.patient.patientNames.familyNames[0] != "")
                searchString += "&name.component[Family].value=~" + $scope.patient.patientNames.familyNames[0];
              if($scope.patient.gender)
                searchString += "&genderConcept=" + $scope.patient.gender;
             
              // TODO: Update the URL so we can re-populate and run search results
            
                OpenIZ.Patient.findAsync(
                {
                  query: searchString,
                  count: 5,
                  continueWith: function(result)
                  {
                    $scope.$apply(function() { $scope.searchResults = result.all('Patient'); });
                  },
                  onException : function(ex) {
                    toastr.error(ex);
                    $('#waitDialog').modal('hide');
                  }
                }
              );
        };

        $scope.register = function(invalid)
        {

          if(!invalid){
             $('#waitDialog').modal('hide');
             var patientData = {
               dateOfBirth : $scope.patient.dob.date,
               dateOfBirthPrecision : $scope.patient.dob.accuracy == 10 ? 'Day' : $scope.patient.dob.accuracy == 7 ? 'Month' : 'Year',
               genderConcept : $scope.patient.gender,
             };
             var patient = new OpenIZModel.Patient(patientData);
             patient.addName(OpenIZModel.NameUseKeys.OfficialRecord, { 
                Given : $scope.patient.patientNames.givenNames,
                Family : $scope.patient.patientNames.familyNames
             });
              OpenIZ.Patient.insertAsync({
               patient : patient,
               continueWith : function(result) {
                 alert("Inserted as " + result.id);
               },
               onException : function(ex) { alert("Error " + ex); }
             });
          }
          else{
            toastr.options = {"positionClass":"toast-top-center",
            "timeOut": 5000};
            toastr.error(localize.getString('locale.toastrText.invalidForm'), localize.getString('locale.toastrHeaders.invalidForm'));
          }
        };

        $scope.initialize();
      }]);

      ]]>
    </contentText>
  </asset>
  <asset name="patient-view-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
      layoutApp.controller('PatientViewController', ['$scope', 'localize', function ($scope, localize)
		  {
        
      }]);
      ]]>
    </contentText>
  </asset>
</AppletManifest>