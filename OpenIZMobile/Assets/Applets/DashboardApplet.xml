<?xml version="1.0" encoding="UTF-8"?>
<!--
 - Copyright 2016-2016 Mohawk College of Applied Arts and Technology
 - 
 - Licensed under the Apache License, Version 2.0 (the "License"); you 
 - may not use this file except in compliance with the License. You may 
 - obtain a copy of the License at 
 - 
 - http://www.apache.org/licenses/LICENSE-2.0 
 - 
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 - WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the 
 - License for the specific language governing permissions and limitations under 
 - the License.
 - 
 - User: Nityan
 - Date: 2016-6-4
 -->
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.timr.applet.dashboard" version="0.5.0.0">
    <icon>@drawable/cogs</icon>
    <name lang="en">Registration</name>
    <name lang="sw">Daftari</name>
    <groupName lang="en">Administration</groupName>
    <groupName lang="sw">Utawala</groupName>
    <author>OpenIZ.org Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>

    <!-- the demand for login -->
    <demand>1.3.6.1.4.1.33349.3.1.5.9.2.1</demand>
  </info>

  <menuItem launch="app://openiz.org/applet/org.timr.applet.dashboard/index">
    <icon>app://openiz.org/drawable/drk_home</icon>
    <text lang="en">Home</text>
    <text lang="sw">Dashibodi</text>
  </menuItem>
  
  <asset name="index" mimeType="text/html">
    <contentHtml>
      <title lang="en">Home</title>
      <title lang="sw">Ya Dashibodi</titleTe  >
      <layout>app://openiz.org/applet/org.timr.applet.layout/layout</layout>
      <script>chart-controller</script>
      <bundle>chart-js</bundle>
      <content>
        <div xmlns="http://www.w3.org/1999/xhtml" class="row" ng-controller="ChartController">
          <div class="container-fluid">
            <div class="row">
              <div class="col-xs-6">
                <h4>{{ 'locale.home.greeting' | i18n }} {{session.identity.name}}!</h4>
              </div>
              <div class="col-xs-6 pull-right">
                <h4>{{ 'locale.home.today' | i18n }} {{ ::now | date:'EEEE MMM dd, yyyy' }}</h4>
              </div>
            </div>
            <div class="row">

              <div class="col-md-4">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">{{ 'locale.queue.panelHeader' | i18n }}</h4>
                  </div>
                  <table class="panel-body table table-striped table-responsive">
                    <tr>
                      <td>{{ 'locale.queue.tableHeader.child' | i18n }}</td>
                      <td>{{ 'locale.queue.tableHeader.due' | i18n }}</td>
                      <td>{{ 'locale.queue.tableHeader.action' | i18n }}</td>
                    </tr>
                    <tr>
                      <td>
                        <a href="/org.timr.applet.patient/view?pid=3049">
                          Smith, John <small>6 wks</small>
                        </a>
                      </td>
                      <td>OPV1</td>
                      <td>
                        <div class="btn-group">
                          <a href="/org.timr.applets.encounter/index?enc=203" class="btn btn-primary">{{ 'locale.queue.action.encounter' | i18n }}</a>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <a href="/org.timr.applet.patient/view?pid=3049">
                          Johnson, Sally <small>6 wks</small>
                        </a>
                      </td>
                      <td>OPV1</td>
                      <td>
                        <div class="btn-group">
                          <a href="/org.timr.applets.encounter/index?enc=203" class="btn btn-primary">{{ 'locale.queue.action.encounter' | i18n }}</a>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
              <div class="col-md-8">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">{{ 'locale.stock.panelHeader' | i18n }}</h4>
                  </div>
                  <div>
                    <canvas id="stockDashboardChart" width="400" height="200"></canvas>
                  </div>
                  <table class="panel-body table table-striped table-responsive">
                    <tr>
                      <td>{{ 'locale.stock.tableHeader.antigen' | i18n }}</td>
                      <td>{{ 'locale.stock.tableHeader.expiry' | i18n }}</td>
                      <td>{{ 'locale.stock.tableHeader.onHand' | i18n }}</td>
                      <td>{{ 'locale.stock.tableHeader.amc' | i18n }}</td>
                      <td>{{ 'locale.stock.tableHeader.remain' | i18n }}</td>
                      <td>{{ 'locale.stock.tableHeader.action' | i18n }}</td>
                    </tr>
                    <tr>
                      <td>
                        ORAL POLIO VACCINE (OPV)<br/><small>Serum Inst. India LN# 20-30293</small>
                      </td>
                      <td>30-JUL-2016</td>
                      <td>40</td>
                      <td>35</td>
                      <td>30 d</td>
                      <td>
                        <div class="btn-group">
                          <a class="btn btn-danger">{{ 'locale.stock.action.adjust' | i18n }}</a>
                        </div>
                      </td>
                    </tr>
                    <tr class="danger">
                      <td>
                        BACILLUS CALMETTA-GUERIN (BCG)<br/><small>Serum Inst. India LN# 34-30293</small>
                      </td>
                      <td>30-JUL-2016</td>
                      <td>20</td>
                      <td>60</td>
                      <td>2 d</td>
                      <td>
                        <div class="btn-group">
                          <a class="btn btn-danger">{{ 'locale.stock.action.adjust' | i18n }}</a>
                        </div>
                      </td>
                    </tr>
                    <tr class="info">
                      <td>
                        MEASLES-RUBELLA (MR)<br/><small>GSK LN# 405-30492</small>
                      </td>
                      <td>12-JUL-2016</td>
                      <td>30</td>
                      <td>10</td>
                      <td>15 d</td>
                      <td>
                        <div class="btn-group">
                          <a class="btn btn-danger">{{ 'locale.stock.action.adjust' | i18n }}</a>
                          <a class="btn btn-success">{{ 'locale.stock.action.order' | i18n }}</a>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="chart-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[  
		    layoutApp.controller('ChartController', ['$scope', 'localize', function ($scope, localize)
		    {
          $scope.now = new Date();
          $scope.session = OpenIZ.Authentication.getSession();
          
          var ctx = $('#stockDashboardChart');
          var stockChart = new Chart(ctx, {
            type: 'bar',
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            },
            data : {
              labels: ["OPV", "BCG", "MR" ],
              datasets : [{
                label: 'On Hand',
                data: [40, 20, 30],
                backgroundColor : [
                  'rgba(128,255,128,0.2)',
                  'rgba(255,128,128,0.2)',
                  'rgba(128,128,255,0.2)'
                ]
              }, {
                label: 'AMC',
                data: [35, 60, 10],
                backgroundColor: [
                  'rgba(128,128,128,0.2)',
                  'rgba(128,128,128,0.2)',
                  'rgba(128,128,128,0.2)'
                ]
              }]
            }
          });
          $scope.logout = function()
          {
            OpenIZ.Authentication.logout();
          }
        
        }]);

		  ]]>
    </contentText>
  </asset>
</AppletManifest>