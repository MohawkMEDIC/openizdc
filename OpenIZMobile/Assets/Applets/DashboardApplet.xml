<?xml version="1.0" encoding="UTF-8"?>
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.openiz.applet.dashboard" version="0.5.0.0">
    <icon>@drawable/cogs</icon>
    <name lang="en">Registration</name>
    <name lang="sw">Daftari</name>
    <groupName lang="en">Administration</groupName>
    <groupName lang="sw">Utawala</groupName>
    <author>OpenIZ.org Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>
    <demand>1.3.6.1.4.1.33349.3.1.5.9.2.1</demand>
  </info>
  <menuItem launch="app://openiz.org/applet/org.openiz.applet.dashboard/index">
    <icon>app://openiz.org/drawable/cogs.png</icon>
    <text lang="en">Register</text>
    <text lang="sw">Daftari</text>
  </menuItem>
  <asset name="index" mimeType="text/html">
    <contentHtml>
      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>select2</bundle>
      <bundle>angular</bundle>
      <bundle>chart-js</bundle>
      <script>chart-controller</script>
      <content lang="en">
        <body xmlns="http://www.w3.org/1999/xhtml" ng-controller="ChartController">
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <!-- Brand and toggle get grouped for better mobile display -->
              <div class="navbar-header">
                <a class="navbar-brand" href="#">Dashboard</a>
              </div>
              <!-- Collect the nav links, forms, and other content for toggling -->
              <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                    <span class="glyphicon glyphicon-user"></span>
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a href="">Manage</a>
                    </li>
                    <li role="separator" class="divider"></li>
                    <li>
                      <a href="">Log Off</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
            <!-- /.container-fluid -->
          </nav>
          <div class="container">

            Dashboard
          <div class="chart-container">
            <canvas id="stock-canvas" height="450" width="600"></canvas>
            <canvas id="vaccination-canvas" height="450" width="600"></canvas>
            <button ng-click="logout()">draw</button>
          </div>
          </div>
          <!-- OpenIZ:Scripts -->
        </body>
      </content>
    </contentHtml>
  </asset>
  <asset name="chart-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[
			  
        
        
        
        var dashboardApp = angular.module('index', []);

		    dashboardApp.controller('ChartController', ['$scope', '$window', '$timeout', '$document', function ($scope, $window, $timeout, $document)
		    {
          $timeout(function(){$scope.logout()}, 10000);
        	
          $scope.logout = function(){
            alert("FUCK");
            OpenIZ.Authentication.abandonSession();
            $window.location.href = "app://openiz.org/applet/org.openiz.applet.dashboard/index";
          }
            $scope.draw = function(){
		          var sctx = document.getElementById("stock-canvas").getContext("2d");
		          window.myLine = new Chart(sctx).Bar(vaccinationChartData, {
			          responsive: true
		          });
              var vctx = document.getElementById("vaccination-canvas").getContext("2d");
		          window.myLine = new Chart(vctx).Bar(stockChartData, {
			          responsive: true
		          });
	        }
        
		var randomScalingFactor = function(){ return Math.round(Math.random()*10000)};
		var vaccinationChartData = {
			labels : ["Clinic 1", "Clinic 2", "Clinic 3", "Clinic 4", "Clinic 5", "Clinic 6", "Clinic 7"],
			datasets : [
				{
					label: "Vaccination Coverage",
					fillColor : "rgba(220,220,220,0.2)",
					strokeColor : "rgba(220,220,220,1)",
					pointColor : "rgba(220,220,220,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(220,220,220,1)",
					data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
				}
        ]}
        var stockChartData = {
        labels : ["Clinic 1", "Clinic 2", "Clinic 3", "Clinic 4", "Clinic 5", "Clinic 6", "Clinic 7"], 
        datasets : [
				{
					label: "Clinic Stock",
					fillColor : "rgba(151,187,205,0.2)",
					strokeColor : "rgba(151,187,205,1)",
					pointColor : "rgba(151,187,205,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(151,187,205,1)",
					data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
				}
			]}
        }]);

		  ]]>
    </contentText>
  </asset>
</AppletManifest>