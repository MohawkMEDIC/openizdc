<?xml version="1.0" encoding="UTF-8"?>
<!--
 - Copyright 2016-2016 Mohawk College of Applied Arts and Technology
 - 
 - Licensed under the Apache License, Version 2.0 (the "License"); you 
 - may not use this file except in compliance with the License. You may 
 - obtain a copy of the License at 
 - 
 - http://www.apache.org/licenses/LICENSE-2.0 
 - 
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 - WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the 
 - License for the specific language governing permissions and limitations under 
 - the License.
 - 
 - User: Nityan
 - Date: 2016-6-4
 -->
<AppletManifest xmlns="http://openiz.org/applet">
  <info id="org.timr.applet.dashboard" version="0.5.0.0">
    <icon>@drawable/cogs</icon>
    <name lang="en">Registration</name>
    <name lang="sw">Daftari</name>
    <groupName lang="en">Administration</groupName>
    <groupName lang="sw">Utawala</groupName>
    <author>OpenIZ.org Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>

    <!-- this is a made up oid for login permission -->
    <demand>1.3.6.1.4.1.33349.3.1.5.9.2.1</demand>
  </info>
  <asset name="index" mimeType="text/html">
    <contentHtml>
      <layout>app://openiz.org/applet/org.timr.applet.layout/layout</layout>
      <script>chart-controller</script>
      <content>
        <div class="container" ng-controller="ChartController" xmlns="http://www.w3.org/1999/xhtml">
          <div class="row">
            <h3>Dashboard</h3>
          </div>
          <div class="row">
            <a class="btn btn-primary pull-left" href="app://openiz.org/applet/org.timr.applet.patientAdministration/index"> Patient Services</a>
          </div>
          <div class="chart-container">
            <canvas id="stock-canvas" height="450" width="600"></canvas>
            <canvas id="vaccination-canvas" height="450" width="600"></canvas>
            <button class="btn btn-primary" ng-click="draw()">Draw</button>
          </div>
        </div>
      </content>
    </contentHtml>
  </asset>
  <asset name="chart-controller" mimeType="text/javascript">
    <contentText>
      <![CDATA[  
		    layoutApp.controller('ChartController', ['$scope', function ($scope)
		    {
        
          $scope.logout = function()
          {
            OpenIZ.Authentication.logout();
          }
        
        	  $scope.draw = function(){
		          var sctx = document.getElementById("stock-canvas").getContext("2d");
		          window.myLine = new Chart(sctx).Bar(vaccinationChartData, {
			          responsive: true
		          });
              var vctx = document.getElementById("vaccination-canvas").getContext("2d");
		          window.myLine = new Chart(vctx).Bar(stockChartData, {
			          responsive: true
		          });
	        }
        
		var randomScalingFactor = function(){ return Math.round(Math.random()*10000)};
		var vaccinationChartData = {
			labels : ["Clinic 1", "Clinic 2", "Clinic 3", "Clinic 4", "Clinic 5", "Clinic 6", "Clinic 7"],
			datasets : [
				{
					label: "Vaccination Coverage",
					fillColor : "rgba(220,220,220,0.2)",
					strokeColor : "rgba(220,220,220,1)",
					pointColor : "rgba(220,220,220,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(220,220,220,1)",
					data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
				}
        ]}
        var stockChartData = {
        labels : ["Clinic 1", "Clinic 2", "Clinic 3", "Clinic 4", "Clinic 5", "Clinic 6", "Clinic 7"], 
        datasets : [
				{
					label: "Clinic Stock",
					fillColor : "rgba(151,187,205,0.2)",
					strokeColor : "rgba(151,187,205,1)",
					pointColor : "rgba(151,187,205,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(151,187,205,1)",
					data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
				}
			]}
        }]);

		  ]]>
    </contentText>
  </asset>
</AppletManifest>