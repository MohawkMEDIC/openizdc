<?xml version="1.0" encoding="UTF-8"?>
<AppletManifest xmlns="http://openiz.org/applet">
	<info id="org.openiz.applet.core.settings" version="0.5.0.0">
    <icon>app://openiz.org/drawable/cogs</icon>
    <name>System Settings</name>
    <groupName>Administration</groupName>
    <author>OpenIZ.org Community</author>
    <dependency id="org.openiz.core" version="0.5.0.0"/>
    <demand>1.3.6.1.4.1.33349.3.1.5.9.2.10</demand>
	</info>
  <menuItem launch="app://openiz.org/applet/org.openiz.applet.core.settings/index">
    <icon>app://openiz.org/drawable/cogs</icon>
    <text lang="en">Settings</text>
  </menuItem>
  <strings lang="en">
    <string key="settings_realmTitle">Realm Settings</string>
    <string key="settings_realmDescription">A realm is a collection of servers with which the mobile application can interact. In order to join the realm you will need to enter the following information about the realm. If your app is already connected to a realm, you may leave the realm using this panel.</string>
    <string key="settings_deviceName">Device Name</string>
    <string key="settings_realm">Realm</string>
    <string key="settings_securityTitle">Security Settings</string>
    <string key="settings_btnLeaveRealm">Leave Realm</string>
    <string key="settings_btnJoinRealm">Join Realm</string>
    <string key="settings_securityDescription">Use this area to configure security settings related to OpenIZ</string>
  </strings>
	<asset name="index" mimeType="text/html">
		<contentHtml>
      <title lang="en">Settings</title>

      <bundle>jquery</bundle>
      <bundle>bootstrap</bundle>
      <bundle>select2</bundle>
      <bundle>angular</bundle>
      <script>index-controller</script>
      <content>
        <body xmlns="http://www.w3.org/1999/xhtml" ng-controller="ConfigurationController">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h3 class="panel-title">{{ "settings_realmTitle" | i18n }}</h3>
                  </div>
                  <div class="panel-body">
                    <div class="container">
                      <div class="row">
                        <div class="col-md-12">
                          <img src="app://openiz.org/drawable/drk_grid" style="width:64px; height:64px; float:left" />
                          <em>
                            {{ "settings_realmDescription" | i18n }}
                          </em>
                        </div>
                      </div>
                    </div>
                    <form name="realmForm" novalidate="novalidate">
                      <div class="input-group">
                        <span class="input-group-addon" id="deviceNameLabel">{{ "settings_deviceName" | i18n }}:</span>
                        <input ng-model="config.security.deviceName" ng-required="true" placeholder="tabletid" ng-pattern="/^[A-Za-z][A-Za-z.0-9-]+$/i" autocorrect="off" autocapitalize="off" spellcheck="false" class="form-control" type="test" name="deviceName" id="deviceName" aria-describedby="deviceNameLabel" />
                        <span class="input-group-addon">
                          <span class=" glyphicon glyphicon-phone">
                          </span>
                        </span>
                      </div>
                      <div class="input-group">
                        <span class="input-group-addon" id="realmServerLabel">{{ "settings_realm" | i18n }}:</span>
                        <input ng-model="config.security.domain" ng-required="true" placeholder="demo.openiz.org" ng-pattern="/^[A-Za-z0-9.-]*$/i" class="form-control" autocorrect="off" autocapitalize="off" spellcheck="false" type="text" name="realmServer" id="realmServer" aria-describedby="realmServerLabel" />
                        <span class="input-group-addon">
                          <span class=" glyphicon glyphicon-globe">
                          </span>
                        </span>
                      </div>
                      <div class="btn-group pull-right">
                        <button class="btn-danger btn" ng-disabled="config.realmName == null" ng-click="leaveRealm(config.security)">
                          <span class="glyphicon glyphicon-resize-full">
                          </span> {{ "settings_btnLeaveRealm" | i18n }}
                        </button>
                        <button class="btn-primary btn" ng-click="joinRealm(config.security)" ng-disabled="realmForm.$invalid || config.realmName != null">
                          {{ "settings_btnJoinRealm" | i18n }} <span class="glyphicon glyphicon-resize-small"></span>
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <form name="configurationForm" novalidate="novalidate">
            <div class="container">
              <!-- Security Settings -->
              <div class="row">
                <div class="col-md-12">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">
                        <a href="#securitySettings" data-toggle="collapse">{{ "settings_securityTitle" | i18n }}</a>
                      </h3>
                    </div>
                    <div class="panel-collapse collapse" id="securitySettings">
                      <div class="panel-body">
                        <div class="container">
                          <div class="row">
                            <div class="col-md-12">
                              <img src="app://openiz.org/drawable/drk_shield" style="width:64px; height:64px; float:left" />
                              <em>{{ "settings_securityDescription" | i18n }}</em>
                            </div>
                          </div>
                        </div>
                        <div class="input-group">
                          <span class="input-group-addon" id="dataRetentionLabel">{{ "settings_securityRetention" | i18n }}:</span>
                          <select ng-model="config.security.retention" class="form-control" name="dataRetention" id="dataRetention" aria-describedBy="dataRetentionLabel">
                            <option value="any">{{ "settings_anySetting" | i18n }}</option>
                            <option value="localonly">{{ "settings_localOnly" | i18n }}</option>
                            <option value="onlineonly">{{ "settings_onlineOnly" | i18n }}</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Facility Settings -->
              <div class="row">
                <div class="col-md-12">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">
                        <a href="#facilitySettings" data-toggle="collapse">{{ "settings_subscribeTitle" | i18n }}</a>
                      </h3>
                    </div>
                    <div class="panel-collapse collapse" id="facilitySettings">
                      <div class="panel-body">
                        <div class="container">
                          <div class="row">
                            <div class="col-md-12">
                              <img src="app://openiz.org/drawable/drk_facility" style="width:64px; height:64px; float:left" />
                              <em>{{ "settings_subscribeDescription" | i18n }}</em>
                            </div>
                          </div>
                        </div>
                        <div class="input-group">
                          <span class="input-group-addon" id="facilityNameLabel">{{ "settings_subscribeFacility" | i18n }}:</span>
                          <select ng-required="true" ng-pattern="/\d+/" data-openiz-tag="select2" multiple="multiple" style="width:100%" ng-model="config.facility.fac" class="form-control" name="dataRetention" id="dataRetention" aria-describedBy="dataRetentionLabel">
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <div class="btn-group pull-right">
                    <button class="btn-danger btn" ng-click="close()">
                      <span class="glyphicon glyphicon-remove">
                      </span> {{ "common_btnCancel" | i18n }}
                    </button>
                    <button class="btn-primary btn" ng-click="save(config)">
                      {{ "common_btnSave" | i18n }} <span class="glyphicon glyphicon-ok"></span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- OpenIZ:Scripts -->
        </body>
      </content>
		</contentHtml>
	</asset>
	<asset name="index-controller" mimeType="text/javascript">
		<contentText>
        <![CDATA[
			// angular stuff
			var configApp = angular.module('index', ['localization']);
      
			configApp.controller('ConfigurationController', ['$scope', 'localize' function ($scope, localize)
			{

				$scope.config = {
					security : OpenIZ.Configuration.getSection("SecurityConfigurationSection"),
					realmName : OpenIZ.Configuration.getRealm()
				};
				$scope.master = {};

				// leave realm
				$scope.leaveRealm = function(realm)
				{
          if(confirm(OpenIZ.Localization.getString("leaveRealm") + realm + "?"))
					  OpenIZ.Configuration.leaveRealm(realm);
				};

				// join realm
				$scope.joinRealm = function(realm) {
          if(OpenIZ.Configuration.joinRealm(realm.domain, realm.deviceName))
            alert(OpenIZ.Localization.getString("joinRealm"));
				};

				// Save config
				$scope.save = function(config) {
					if(OpenIZ.Configuration.save(config))
						OpenIZ.App.close();
				};

				$scope.reset = function() {
					$scope.user = angular.copy($scope.master);
				};

				$scope.reset();
			}]);

		]]></contentText>
	</asset>
</AppletManifest>