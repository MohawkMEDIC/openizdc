/**
 * @version 0.9.6 (Edmonton)
 * @copyright (C) 2015-2018, Mohawk College of Applied Arts and Technology
 * @license Apache 2.0
 */
window.alert_=window.alert;window.alert=function(){alert_.apply(window,arguments)};var OpenIZApplicationService=window.OpenIZApplicationService||{},OpenIZ=OpenIZ||{urlParams:{},UserInterface:{PatientControllerPrototype:function(){this.view=function(){alert("Default implementation, not implemented ")};this.download=function(){alert("Default implementation, not implemented ")};this.save=function(n,t){var t={data:n,id:n.id,versionId:n.version,continueWith:function(i){console.log(i);switch(i.multipleBirthOrder){case 1:i.multipleBirthOrderText=OpenIZ.Localization.getString("locale.patient.demographics.multipleBirth.first");break;case 2:i.multipleBirthOrderText=OpenIZ.Localization.getString("locale.patient.demographics.multipleBirth.second");break;case 3:i.multipleBirthOrderText=OpenIZ.Localization.getString("locale.patient.demographics.multipleBirth.third");break;case 0:i.multipleBirthOrderText=OpenIZ.Localization.getString("locale.patient.demographics.multipleBirth.unknown")}i.multipleBirthOrder!=undefined&&i.multipleBirthOrder!=null&&(i.multipleBirthOrder=i.multipleBirthOrder.toString());OpenIZ.Patient.getAsync({id:n.id,continueWith:t.continueWith,onException:t.onException})},onException:t.onException,"finally":t.finally,state:0};delete n.genderConceptModel;n.relationship&&n.relationship.DedicatedServiceDeliveryLocation&&n.relationship.DedicatedServiceDeliveryLocation.targetModel&&delete n.relationship.DedicatedServiceDeliveryLocation.targetModel;n.address.HomeAddress.villageId!=null?OpenIZ.Place.findAsync({query:{_id:n.address.HomeAddress.villageId,_viewModel:"min"},continueWith:function(i){n.address.HomeAddress.component=i.address.Direct.component;OpenIZ.Patient.updateAsync(t)},onException:t.onException}):OpenIZ.Patient.updateAsync(t)}},patientController:null},Act:{updateAsync:function(n){OpenIZ.Ims.put({resource:"Act",data:n.data,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,id:n.id,state:n.state})},obsoleteAsync:function(n){OpenIZ.Ims.delete({resource:"Act",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,id:n.id,data:n.data,state:n.state})},cancelAsync:function(n){OpenIZ.Ims.cancel({resource:"Act",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,id:n.id,data:n.data,state:n.state})},nullifyAsync:function(n){OpenIZ.Ims.nullify({resource:"Act",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,id:n.id,data:n.data,state:n.state})},createFulfillment:function(n){var t=new OpenIZModel.Act,u,f,i,r;switch(n.$type){case"SubstanceAdministration":t=new OpenIZModel.SubstanceAdministration(n);break;case"Observation":t=new OpenIZModel.Observation(n);break;case"QuantityObservation":t=new OpenIZModel.QuantityObservation(n);break;case"CodedObservation":t=new OpenIZModel.CodedObservation(n);break;case"TextObservation":t=new OpenIZModel.TextObservation(n);break;case"PatientEncounter":t=new OpenIZModel.PatientEncounter(n);break;case"ControlAct":t=new OpenIZModel.ControlAct(n)}t.tag={};n.stopTime<new Date&&(t.tag.backEntry=!0);t.tag.originalDate=Math.floor(new Date(OpenIZ.Util.toDateInputString(n.actTime)).getTime()/1e3);t.id=OpenIZ.App.newGuid();t.moodConcept=OpenIZModel.ActMoodKeys.Eventoccurrence;t.moodConceptModel=null;t.creationTime=new Date;t.createdBy=t.createdByModel=null;t.statusConcept=OpenIZModel.StatusKeys.Active;t.statusConceptModel=null;t.etag=null;t.relationship=t.relationship||{};t.relationship.Fulfills=new OpenIZModel.ActRelationship;t.relationship.Fulfills.target=n.id;t.relationship.Fulfills.targetModel=n;u=Object.keys(t.participation);for(f in u)if(i=u[f],t.participation[i].splice!==undefined)for(r in t.participation[i])t.participation[i][r]=new OpenIZModel.ActParticipation({act:t.id,player:t.participation[i][r].player,playerModel:t.participation[i][r].playerModel});else t.participation[i]=new OpenIZModel.ActParticipation({act:t.id,player:t.participation[i].player,playerModel:t.participation[i].playerModel});return t.actTime=t.tag.backEntry?n.actTime:new Date,t.startTime=t.stopTime=null,t},findAsync:function(n){OpenIZ.Ims.get({resource:"Act",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:n.query,state:n.state})},insertAsync:function(n){OpenIZ.Ims.post({resource:"Act",continueWith:n.continueWith,onException:n.onException,data:n.data,state:n.state,"finally":n.finally})},getActTemplateAsync:function(n){OpenIZ.Ims.get({resource:"Act/Template",query:{templateId:n.templateId,_viewModel:"full"},continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},findClinicalActAsync:function(n){var t=["Act"],i=function(r,u,f,e){var o=n.query;o._queryId=u;o._offset=f;o._count=e;OpenIZ.Ims.get({resource:t[r],continueWith:function(o){n.intermediateResults(o);o.offset+o.count<o.totalResults?i(r,u,f+e,e):++r<t.length?i(r,u,f+e,e):n.continueWith(o)},onException:n.onException,"finally":function(){r>=t.length&&n.finally},query:o,state:n.state})};i(0,OpenIZ.App.newGuid(),0,50)}},Audit:{getAuditAsync:function(n){OpenIZ.Util.simpleGet("/__audit/audit",n)}},Ims:{post:function(n){$.ajax({method:"POST",url:"/__ims/"+n.resource,data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){try{n.continueWith!==undefined&&n.continueWith(t,n.state)}catch(i){if(n.onException!==undefined)n.onException(i,n.state)}finally{n.finally!==undefined&&n.finally(n.state)}},error:function(t){var i=t.responseJSON;if(n.onException===null)console.error(i);else if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)},async:!(n.synchronous||!1)})},put:function(n){$.ajax({method:"PUT",url:"/__ims/"+n.resource+"?_id="+n.id+"&_versionId="+n.versionId,data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){try{n.continueWith!==undefined&&n.continueWith(t,n.state)}catch(i){if(n.onException!==undefined)n.onException(i,n.state)}finally{n.finally!==undefined&&n.finally(n.state)}},error:function(t){var i=t.responseJSON;if(n.onException===null)console.error(i);else if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})},get:function(n){$.ajax({method:"GET",url:"/__ims/"+n.resource,data:n.query,dataType:"json",accept:"application/json",contentType:"application/json",success:function(t){try{n.continueWith!==undefined&&n.continueWith(t,n.state)}catch(i){if(n.onException!==undefined)n.onException(i,n.state)}finally{n.finally!==undefined&&n.finally(n.state)}},error:function(t){var i=t.responseJSON;if(n.onException===undefined)console.error(i);else if(i!=undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)},async:!(n.synchronous||!1)})},"delete":function(n){$.ajax({method:"DELETE",url:"/__ims/"+n.resource+"?_id="+n.id,accept:"application/json",contentType:"application/json",data:JSON.stringify(n.data),dataType:"json",success:function(t){try{n.continueWith!==undefined&&n.continueWith(t,n.state)}catch(i){if(n.onException!==undefined)n.onException(i,n.state)}finally{n.finally!==undefined&&n.finally(n.state)}},error:function(t){var i=t.responseJSON;if(n.onException===undefined)console.error(i);else if(i!=undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})},nullify:function(n){$.ajax({method:"NULLIFY",url:"/__ims/"+n.resource+"?_id="+n.id,accept:"application/json",contentType:"application/json",data:JSON.stringify(n.data),dataType:"json",success:function(t){try{n.continueWith!==undefined&&n.continueWith(t,n.state)}catch(i){if(n.onException!==undefined)n.onException(i,n.state)}finally{n.finally!==undefined&&n.finally(n.state)}},error:function(t){var i=t.responseJSON;if(n.onException===undefined)console.error(i);else if(i!=undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})},cancel:function(n){$.ajax({method:"CANCEL",url:"/__ims/"+n.resource+"?_id="+n.id,accept:"application/json",contentType:"application/json",data:JSON.stringify(n.data),dataType:"json",success:function(t){try{n.continueWith!==undefined&&n.continueWith(t,n.state)}catch(i){if(n.onException!==undefined)n.onException(i,n.state)}finally{n.finally!==undefined&&n.finally(n.state)}},error:function(t){var i=t.responseJSON;if(n.onException===undefined)console.error(i);else if(i!=undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})}},Stock:{calculateQPeriod:function(n,t){return n/12*t},calculateSReserve:function(n,t){return n*t},calculateSMax:function(n,t){return n+t},calculateSReorder:function(n,t,i,r){return n+t*i/r},calculateQOrder:function(n,t,i,r,u){return n-t+i*r/u},calculateQNeeded:function(n,t,i,r){return n+t-(i+r)},calculateAll:function(n,t,i,r,u){var f={};return f.qPeriod=OpenIZ.Stock.calculateQPeriod(n,t),f.sReserve=OpenIZ.Stock.calculateSReserve(f.qPeriod,i),f.sMax=OpenIZ.Stock.calculateSMax(f.qPeriod,f.sReserve),f.sReorder=OpenIZ.Stock.calculateSReorder(f.sReserve,f.qPeriod,r,t),f.qOrder=OpenIZ.Stock.calculateQOrder(f.sMax,u,f.qPeriod,r,t),f}},Risi:{getReportsAsync:function(n){OpenIZ.Util.simpleGet("/__risi/report",{query:{_name:n.name},continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},executeDatasetAsync:function(n){var t=n.query||{};t._name=n.name;t._report=n.report;OpenIZ.Util.simpleGet("/__risi/data",{query:t,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},executeReportAsync:function(n){var i={},r,t;if(i._name=n.name,i._view=n.view,n.query)for(r in Object.keys(n.query))t=Object.keys(n.query)[r],i[t]=n.query[t]&&n.query[t].toISOString?n.query[t].toISOString():n.query[t];OpenIZ.Util.simpleGet("/__risi/report.htm",{query:i,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state},!0)}},Util:{simplePost:function(n,t){t.onException=t.onException||OpenIZ.Util.logException;$.ajax({method:"POST",url:n,data:JSON.stringify(t.data),dataType:"json",contentType:"application/json",success:function(n){t.continueWith!==undefined&&t.continueWith(n,t.state);t.finally!==undefined&&t.finally(t.state)},error:function(n){var i=n.responseJSON;if(t.onException===null)console.error(i);else if(i.error!==undefined)t.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general"+i,n,null),t.state);t.finally!==undefined&&t.finally(t.state)}})},simplePut:function(n,t){t.onException=t.onException||OpenIZ.Util.logException;$.ajax({method:"PUT",url:t==null||t.query==null?n:n+"?"+t.query,data:JSON.stringify(t.data),dataType:"json",contentType:"application/json",success:function(n){t.continueWith!==undefined&&t.continueWith(n,t.state);t.finally!==undefined&&t.finally(t.state)},error:function(n){var i=n.responseJSON;if(t.onException===null)console.error(i);else if(i.error!==undefined)t.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general"+i,n,null),t.state);t.finally!==undefined&&t.finally(t.state)}})},simpleDelete:function(n,t){t.onException=t.onException||OpenIZ.Util.logException;$.ajax({method:"DELETE",url:t==null||t.query==null?n:n+"?"+t.query,dataType:"json",contentType:"application/json",success:function(n){try{t.continueWith!==undefined&&t.continueWith(n,t.state)}catch(i){if(t.onException!==undefined)t.onException(i,t.state)}finally{t.finally!==undefined&&t.finally(t.state)}},error:function(n){var i=n.responseJSON;if(t.onException===null)console.error(i);else if(i!==undefined&&i.error!==undefined)t.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general"+i,n,null),t.state);t.finally!==undefined&&t.finally(t.state)}})},simpleGet:function(n,t,i){t.onException=t.onException||OpenIZ.Util.logException;i?$.get(n,t.query,function(n){try{if(n!=null&&n.error!==undefined)t.onException(new OpenIZModel.Exception(n.type,n.error,null,null),t.state);else if(n!=null)t.continueWith(n,t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general",n,null),t.state)}catch(i){if(t.onException!==undefined)t.onException(i,t.state)}finally{t.finally!==undefined&&t.finally(t.state)}}).error(function(n){var i=n.responseJSON;if(i!=null&&i.error!==undefined)t.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general"+i,n),t.state)}).always(function(){t.finally!==undefined&&t.finally(t.state)}):$.getJSON(n,t.query,function(n){try{if(n!=null&&n.error!==undefined)t.onException(new OpenIZModel.Exception(n.type,n.error,null,null),t.state);else if(n!=null)t.continueWith(n,t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general",n,null),t.state)}catch(i){if(t.onException!==undefined)t.onException(i,t.state)}finally{t.finally!==undefined&&t.finally(t.state)}}).error(function(n){var i=n.responseJSON;if(i!=null&&i.error!==undefined)t.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),t.state);else t.onException(new OpenIZModel.Exception("Exception","err_general"+i,n,null),t.state)}).always(function(){t.finally!==undefined&&t.finally(t.state)})},logException:function(n){console.warn(n)},renderConceptFromDom:function(n){if(n)return $("option[value="+n+"]").first().text()},renderConceptName:function(n){var t="";return t=n==null?"":typeof n=="String"?n:n[OpenIZ.Localization.getLocale()]!=null?n[OpenIZ.Localization.getLocale()]:n[Object.keys(n)],Array.isArray(t)?t[0]:t},renderAddress:function(n){if(n!==undefined){var t=n.component!==undefined?n:n.address!==undefined?n.address.Direct||n.address.HomeAddress||result.name.$other:n.Direct||n.HomeAddress||n.$other,i="";return t.component&&(t.component.AdditionalLocator&&(i+=t.component.AdditionalLocator+", "),t.component.StreetAddressLine&&(i+=t.component.StreetAddressLine+", "),t.component.Precinct&&(i+=t.component.Precinct+", "),t.component.City&&(i+=t.component.City+", "),t.component.County!=null&&(i+=t.component.County+", "),t.component.State!=null&&(i+=t.component.State+", "),t.component.Country!=null&&(i+=t.component.Country+", ")),i.substring(0,i.length-2)}},renderAct:function(n){switch(n.$type){case"SubstanceAdministration":return OpenIZ.Localization.getString("locale.encounters.administer")+OpenIZ.Util.renderName(n.participation.Product.name.OfficialRecord);case"QuantityObservation":case"CodedObservation":case"TextObservation":return OpenIZ.Localization.getString("locale.encounters.observe")+n.typeConceptModel.name[OpenIZ.Localization.getLocale()];default:return""}},renderManufacturedMaterial:function(n){var t=OpenIZ.Util.renderName(n.name.OfficialRecord||n.name.Assigned);return t+"[LN#: "+n.lotNumber+"]"},renderName:function(n){if(n===null||n===undefined)return"";if(n.join!==undefined)return n.join(" ");if(n.component!==undefined){var t="";return n.component.Given!==undefined&&(typeof n.component.Given=="string"?t+=n.component.Given:n.component.Given.join!==undefined&&(t+=n.component.Given.join(" ")),t+=" "),n.component.Family!==undefined&&(typeof n.component.Family=="string"?t+=n.component.Family:n.component.Family.join!==undefined&&(t+=n.component.Family.join(" "))),n.component.$other!==undefined&&(typeof n.component.$other=="string"?t+=n.component.$other:n.component.$other.join!==undefined?t+=n.component.$other.join(" "):n.component.$other.value!==undefined&&(t+=n.component.$other.value)),t}return typeof n=="string"?n:""},toDateInputString:function(n){if(n){if(n.getYear){var u=(1900+n.getYear()).toString(),t=(1+n.getMonth()).toString(),i=n.getDate().toString(),r="00";return t=r.substring(0,2-t.length)+t,i=r.substring(0,2-i.length)+i,u+"-"+t+"-"+i}return n.toISOString()}return null},startTaskAsync:function(n,t){return setTimeout(function(){try{t.continueWith(n(),t.state)}catch(i){if(t.onException===undefined)console.error(i);else t.onException(i,t.state)}},0)}},Authentication:{$session:null,$elevationCredentials:{},$sessionExpiredHandler:function(){window.location.reload()},sendTfaSecretAsync:function(n){OpenIZ.Util.simplePost("/__auth/tfa",n)},getTfaMechanisms:function(n){OpenIZ.Util.simpleGet("/__auth/tfa",n)},showElevationDialog:function(){$("#authenticationDialog").modal("show")},hideElevationDialog:function(){OpenIZ.App.hideWait("#loginButton");$("#authenticationDialog").modal("hide")},loginAsync:function(n){$.ajax({method:"POST",url:"/__auth/authenticate",data:{username:n.userName,password:n.password,grant_type:n.tfaSecret!=null?"tfa":"password",tfaSecret:n.tfaSecret,scope:n.scope},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t){if(t!=null&&t.error!==undefined)n.onException(new OpenIZModel.Exception(t.type,t.error,null),n.state);else if(t!=null)n.scope&&n.scope!=""||(OpenIZ.Authentication.$session=t),n.continueWith(t,n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general",t),n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t),n.state);n.finally!==undefined&&n.finally(n.state)}})},setPasswordAsync:function(n){$.ajax({method:"POST",url:"/__auth/passwd",data:{username:n.userName,password:n.password},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t){if(t!=null&&t.error!==undefined)n.onException(new OpenIZModel.Exception(t.type,t.error,null),n.state);else if(t!=null)n.continueWith(t,n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general",t));n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,t.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t),n.state);n.finally!==undefined&&n.finally(n.state)}})},getSessionAsync:function(n){OpenIZ.Util.simpleGet("/__auth/get_session",{continueWith:function(t){OpenIZ.Authentication.$session=t;n.continueWith&&n.continueWith(t)},"finally":n.finally,onException:n.onException,state:n.state})},abandonSession:function(n){$.ajax({method:"POST",url:"/__auth/abandon",dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t){OpenIZ.Authentication.$session=null;n.continueWith(t,n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,null),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})},refreshSessionAsync:function(n){$.ajax({method:"POST",url:"/__auth/authenticate",data:{grant_type:"refresh"},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t){if(t!=null&&t.error!==undefined)n.onException(new OpenIZModel.Exception(t.type,t.error,null),n.state);else if(t!=null)OpenIZ.Authentication.$session=t,n.continueWith(t,n.state),OpenIZ.Authentication.$session=t;else n.onException(new OpenIZModel.Exception("Exception","err_general",t),n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t),n.state);n.finally!==undefined&&n.finally(n.state)}})},getUserAsync:function(n){OpenIZ.Ims.get({resource:"UserEntity",query:n.query,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},saveUserAsync:function(n){OpenIZ.Util.simplePost("/__auth/SecurityUser",{resource:"SecurityUser",data:n.data,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})}},CarePlan:{refreshAsync:function(n){OpenIZ.Util.simplePost("/__plan/refresh",n)},interpretObservation:function(n,t){if(n.value!==undefined&&n.value!==null){n.participation=n.participation||{};n.participation.RecordTarget=n.participation.RecordTarget||{};n.participation.RecordTarget.playerModel=t;var i=OpenIZBre.ExecuteRule("BeforeInsert",n);return n.interpretationConcept=i.interpretationConcept,n.participation.RecordTarget.playerModel=null,i.interpretationConcept}},getCarePlanAsync:function(n){var t="/__plan/patient?moodConcept=ACF7BAF2-221F-4BC2-8116-CEB5165BE079";n.minDate!==undefined&&(t+="&actTime=>"+n.minDate.toISOString());n.maxDate!==undefined&&(t+="&actTime=<"+n.maxDate.toISOString());n.onDate!==undefined&&(t+="&startTime=<"+n.onDate.toISOString());n.classConcept!==undefined&&(t+="&classConcept="+n.classConcept);n.query!==undefined&&(t+="&"+n.query);console.info("Generating care plan...");$.ajax({method:"POST",url:t,data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){console.info("Retrieved care plan...");n.continueWith(t,n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(n.onException!==undefined)if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t),n.state);n.finally!==undefined&&n.finally(n.state)}})},getEntityTemplateAsync:function(n){OpenIZ.Entity.getEntityTemplateAsync(n)},getActTemplateAsync:function(n){OpenIZ.Act.getActTemplateAsync(n)}},App:{DatePrecisionFormats:{DateFormatYear:"YYYY",DateFormatMonth:"YYYY-MM",DateFormatDay:"YYYY-MM-DD",DateFormatHour:"YYYY-MM-DD HH",DateFormatMinute:"YYYY-MM-DD HH:mm",DateFormatSecond:"YYYY-MM-DD HH:mm:ss"},_originalText:{},getTicklesAsync:function(n){OpenIZ.Util.simpleGet("/__app/tickle",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},doUpdateAsync:function(n){OpenIZ.Util.simplePost("/__app/update",{continueWith:n.continueWith,data:{appId:n.appId},onException:n.onException,"finally":n.finally})},compactAsync:function(n){OpenIZ.Util.simplePost("/__app/data",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},purgeDataAsync:function(n){OpenIZ.Util.simpleDelete("/__app/data",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:"backup="+n.backup})},restoreDataAsync:function(n){OpenIZ.Util.simplePost("/__app/data/restore",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},backupDataAsync:function(n){OpenIZ.Util.simplePost("/__app/data/backup",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},getBackupAsync:function(n){OpenIZ.Util.simpleGet("/__app/data/backup",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},loadDataAsset:function(n){return atob(OpenIZApplicationService.GetDataAsset(n))},submitBugReportAsync:function(n){OpenIZ.Util.simplePost("/__app/bug",n)},getLogInfoAsync:function(n){return OpenIZ.Util.simpleGet("/__app/log",n)},newGuid:function(){return OpenIZApplicationService.NewGuid()},getInfoAsync:function(n){n.includeUpdates?OpenIZ.Util.simpleGet("/__app/info.max",n):OpenIZ.Util.simpleGet("/__app/info",n)},getHealthAsync:function(n){OpenIZ.Util.simpleGet("/__app/health",n)},getOnlineState:function(){return OpenIZApplicationService.GetOnlineState()},isAdminAvailable:function(){return OpenIZApplicationService.IsAdminAvailable()},isClinicalAvailable:function(){return OpenIZApplicationService.IsClinicalAvailable()},statusShown:!1,resolveTemplateForm:function(n){if(n)return OpenIZApplicationService.GetTemplateForm(n)},resolveTemplateView:function(n){if(n)return OpenIZApplicationService.GetTemplateView(n)},getTemplateDefinitions:function(){return OpenIZApplicationService.GetTemplates?JSON.parse(OpenIZApplicationService.GetTemplates()):["act.substanceadmin.immunization","act.observation.weight","act.substanceadmin.supplement","act.concern.aefi","act.problem","act.observation.causeofdeath"]},updateStatus:function(){var n=JSON.parse(OpenIZApplicationService.GetStatus());n[1]>0&&n[1]<1?($("#waitModalText").text(OpenIZ.Localization.getString("locale.dialog.wait.background")+":"+n[0]),$("#waitProgressBar").attr("style","width:"+n[1]*100+"%")):($("#waitModalText").text(OpenIZ.Localization.getString("locale.dialog.wait.text")+":"+n[0]),$("#waitProgressBar").attr("style","width:100%"));OpenIZ.App.statusShown&&setTimeout(OpenIZ.App.updateStatus,1e3)},showWait:function(n){OpenIZ.App._originalText[n]=$(n).html();$(n).attr("disabled","disabled");$(n).html("<img src='/org.openiz.core/img/ajax-loader.gif' class='spinloader'> "+OpenIZ.Localization.getString("locale.dialog.wait.text"))},networkAvailable:function(){try{return OpenIZApplicationService.GetNetworkState()}catch(n){return!1}},hideWait:function(n){$(n).removeAttr("disabled");$(n).html(OpenIZ.App._originalText[n])},getService:function(n){for(var t in OpenIZ.Configuration.$configuration.application.service)if(OpenIZ.Configuration.$configuration.application.service[t].lastIndexOf(n)>0)return OpenIZ.Configuration.$configuration.application.service[t];return null},getVersion:function(){return OpenIZApplicationService.GetVersion()},getCurrentAssetTitle:function(){return $(document).find("title").text()},getMenusAsync:function(n){OpenIZ.Util.simpleGet("/__app/menu",n)},scanBarcode:function(){try{var t=OpenIZApplicationService.BarcodeScan();return console.log("Barcode scan complete. Data: "+t),t}catch(n){console.error(n);throw new OpenIZModel.Exception("Exception",OpenIZ.Localization.getString("err_scan_barcode"),n.message,n);}},back:function(){try{var t=OpenIZApplicationService.Back()}catch(n){console.error(n)}},close:function(){try{var t=OpenIZApplicationService.Close()}catch(n){console.error(n)}},toast:function(n){try{var i=OpenIZApplicationService.ShowToast(n)}catch(t){console.error(t)}},navigateApplet:function(n,t){try{OpenIZApplicationService.Navigate(n,JSON.stringify(t))}catch(i){console.error(i)}},getAlertsAsync:function(n){OpenIZ.Util.simpleGet("/__app/alerts",n)},saveAlertAsync:function(n){$.ajax({method:"POST",url:"/__app/alerts",data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){n.continueWith!==undefined&&n.continueWith(t,n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(n.onException===null)console.error(i);else if(i!==undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})},deleteAlertAsync:function(n){OpenIZ.Util.simpleDelete("/__app/alerts",{query:"id="+n.id,continueWith:n.continueWith,"finally":n.finally,onException:n.onException,state:n.state})},deleteCacheAsync:function(n){OpenIZ.Util.simpleDelete("/__app/cache",{query:"id="+n.data.id+"&type="+n.data.$type,continueWith:n.continueWith,"finally":n.finally,onException:n.onException,state:n.state})}},Localization:{getString:function(n){try{var t=OpenIZApplicationService.GetString(n);return t==undefined?n||"":t}catch(i){return console.error(i),n}},getLocale:function(){return OpenIZ.Localization.$locale||(OpenIZ.Localization.$locale=OpenIZApplicationService.GetLocale()),OpenIZ.Localization.$locale},setLocale:function(n){if(OpenIZApplicationService.SetLocale!==undefined)return OpenIZApplicationService.SetLocale(n);delete OpenIZ.Localization.$locale},getStrings:function(n){try{var i=OpenIZApplicationService.GetStrings(n);return i==null?null:JSON.parse(i)}catch(t){console.error(t);throw new OpenIZModel.Exception("Exception","Error getting string list",t.message,t);}}},Concept:{findConceptAsync:function(n){OpenIZ.Ims.get({resource:"Concept",query:n.query,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},findConceptSetAsync:function(n){OpenIZ.Ims.get({resource:"ConceptSet",query:n.query,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})}},Bundle:{insertAsync:function(n){OpenIZ.Ims.post({resource:"Bundle",continueWith:n.continueWith,onException:n.onException,data:n.data,state:n.state,"finally":n.finally,synchronous:n.synchronous})}},Patient:{findAsync:function(n){OpenIZ.Ims.get({resource:"Patient",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:n.query,state:n.state})},insertAsync:function(n){OpenIZ.Ims.post({resource:"Patient",continueWith:n.continueWith,onException:n.onException,data:n.data,state:n.state})},updateAsync:function(n){OpenIZ.Ims.put({resource:"Patient",data:n.data,id:n.id,continueWith:n.continueWith,onException:n.onException,versionId:n.versionId,"finally":n.finally,state:n.state})},obsoleteAsync:function(n){OpenIZ.Ims.delete({resource:"Patient",id:n.id,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},getAsync:function(n){OpenIZ.Ims.get({resource:"Patient",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:{_id:n.id||n.patientId,_viewModel:"full"},state:n.state})},downloadAsync:function(n){OpenIZ.Util.simpleGet("/__ims/Patient.Download",{query:{_id:n.id},continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})}},Place:{findAsync:function(n){OpenIZ.Ims.get({resource:"Place",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:n.query,state:n.state,synchronous:n.synchronous})},bindSelect:function(n,t){$(n).select2({ajax:{url:"/__ims/Place",dataType:"json",delay:500,method:"GET",data:function(n){return t["name.component.value"]="~"+n.term,t._count=5,t._offset=0,t},processResults:function(n,t){return t.page=t.page||0,{results:n.item,pagination:{more:n.offset+n.count<n.total}}},cache:!0},escapeMarkup:function(n){return n},minimumInputLength:4,templateSelection:function(n){return n.name!=null?"<span class='glyphicon glyphicon-map-marker'><\/span> "+n.name.OfficialRecord.component.$other.value:"<span class='glyphicon glyphicon-map-marker'><\/span> "+n.text},templateResult:function(n){return n.text!=null?n.text:"<div class='label label-default'>"+n.typeConceptModel.name[OpenIZ.Localization.getLocale()]+"<\/div> "+n.name.OfficialRecord.component.$other.value}})}},Provider:{findProviderAsync:function(n){OpenIZ.Ims.get({continueWith:n.continueWith,onException:n.onException,"finally":n.finally,resource:"Provider",query:n.query,state:n.state})},bindSelect:function(n,t){$(n).select2({ajax:{url:"/__ims/Provider",dataType:"json",delay:500,method:"GET",data:function(n){return t["name.component.value"]="~"+n.term,t._count=5,t._offset=0,t},processResults:function(n,t){return t.page=t.page||0,{results:n.item,pagination:{more:n.offset+n.count<n.total}}},cache:!0},escapeMarkup:function(n){return n},minimumInputLength:1,templateSelection:function(n){return n.text!=null?"<span class='glyphicon glyphicon-user'><\/span> "+n.text:"<span class='glyphicon glyphicon-user'><\/span> "+OpenIZ.Util.renderName(n.name.OfficialRecord)},templateResult:function(n){return n.text!=null?n.text:"<span class='glyphicon glyphicon-user'><\/span> "+OpenIZ.Util.renderName(n.name.OfficialRecord)}})}},Entity:{getEntityTemplateAsync:function(n){OpenIZ.Ims.get({resource:"Entity/Template",query:{templateId:n.templateId},continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})}},Configuration:{$configuration:null,getConfigurationAsync:function(n){OpenIZ.Util.simpleGet("/__config/all",{continueWith:function(t){OpenIZ.Configuration.$configuration=t;n.continueWith(t,n.state)},onException:n.onException,"finally":n.finally,state:n.state})},getApplicationSetting:function(n){try{for(var i in OpenIZ.Configuration.$configuration.application.setting)if(OpenIZ.Configuration.$configuration.application.setting[i].key==n)return OpenIZ.Configuration.$configuration.application.setting[i].value;return null}catch(t){throw new OpenIZModel.Exception("Exception",t.message,t.detail,t);}},setApplicationSetting:function(n,t){try{for(var r in OpenIZ.Configuration.$configuration.application.setting)if(OpenIZ.Configuration.$configuration.application.setting[r].key==n){OpenIZ.Configuration.$configuration.application.setting[r].value=t;return}OpenIZ.Configuration.$configuration.application.setting.push({key:n,value:t})}catch(i){throw new OpenIZModel.Exception("Exception",i.message,i.detail,i);}},getRealm:function(){try{return OpenIZ.Configuration.$configuration.realmName}catch(n){console.error(n)}},getSection:function(n){try{return OpenIZ.Configuration.$configuration[n]}catch(t){console.error(t)}},joinRealmAsync:function(n){try{$.ajax({method:"POST",url:"/__config/realm",data:{realmUri:n.domain,deviceName:n.deviceName,force:n.force,enableTrace:n.enableTrace,enableSSL:n.enableSSL,port:n.port},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t,i){if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,null,i.caused_by),n.state);else if(i!=null)OpenIZ.Configuration.$configuration=t,n.continueWith(t,n.state);else if(n.onException!=null)n.onException(new OpenIZModel.Exception("Exception","err_general",i,null),n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else if(n.onException!=null)n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})}catch(t){console.error(t)}},leaveRealm:function(){try{return confirm("You are about to leave the realm "+OpenIZ.Configuration.$configuration.realmName+". Doing so will force the OpenIZ back into an initial configuration mode. Are you sure you want to do this?")?OpenIZConfigurationService.LeaveRealm():!1}catch(n){console.error(n)}},saveAsync:function(n){try{$.ajax({method:"POST",url:"/__config/all",data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t,i){if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,null,i.caused_by),n.state);else if(i!=null)OpenIZ.Configuration.$configuration=t,n.continueWith(t,n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general",i,null),n.state);n.finally!==undefined&&n.finally(n.state)},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.type,i.error,i.error_description,i.caused_by),n.state);else n.onException(new OpenIZModel.Exception("Exception","err_general"+i,t,null),n.state);n.finally!==undefined&&n.finally(n.state)}})}catch(t){console.error(t)}},getAppletSettingsAsync:function(n){OpenIZ.Util.simpleGet("/__config/user",{query:{_id:n.appletId},continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},saveAppletSettingsAsync:function(n){OpenIZ.Util.simplePost("/__config/user?_id="+n.appletId,{data:n.settings,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},getUserPreferencesAsync:function(n){OpenIZ.Util.simpleGet("/__config/user",n)},saveUserPreferencesAsync:function(n){OpenIZ.Util.simplePost("/__config/user",n)}},Material:{findMaterialAsync:function(n){return OpenIZ.Material.getMaterialAsync(n)},getMaterialAsync:function(n){var t=n.query||{};n instanceof String?t+="&classConcept="+OpenIZModel.EntityClassKeys.Material:t.classConcept=OpenIZModel.EntityClassKeys.Material;OpenIZ.Ims.get({resource:"Material",continueWith:n.continueWith,onException:n.onException,query:t,"finally":n.finally,state:n.state})}},ManufacturedMaterial:{getManufacturedMaterials:function(n){OpenIZ.ManufacturedMaterial.getManufacturedMaterialAsync(n)},getManufacturedMaterialAsync:function(n){OpenIZ.Ims.get({resource:"ManufacturedMaterial",continueWith:n.continueWith,onException:n.onException,query:n.query,state:n.state})}},UserEntity:{updateAsync:function(n){OpenIZ.Ims.put({resource:"UserEntity",continueWith:n.continueWith,onException:n.onException,data:n.data,state:n.state})}},Queue:{QueueNames:{InboundQueue:"inbound",OutboundQueue:"outbound",DeadLetterQueue:"dead",AdminQueue:"admin"},forceResyncAsync:function(n){OpenIZ.Util.simplePost("/__app/queue",{continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},getQueueAsync:function(n){OpenIZ.Util.simpleGet("/__app/queue",{query:{_queue:n.queueName,id:"!null",_id:n.id},continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},requeueDeadAsync:function(n){OpenIZ.Util.simplePut("/__app/queue",{query:"_id="+n.queueId,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},deleteQueueAsync:function(n){OpenIZ.Util.simpleDelete("/__app/queue",{query:"_id="+n.queueId+"&_queue="+n.queueName,continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})},resubmitAsync:function(n){OpenIZ.Util.simplePut("/__app/data/sync",{query:"creationTime=<"+OpenIZ.Util.toDateInputString(n.to||new Date)+"T23:59:59&creationTime=>"+OpenIZ.Util.toDateInputString(n.from||new Date)+"T00:00:00",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,state:n.state})}}};OpenIZ.UserInterface.patientController=new OpenIZ.UserInterface.PatientControllerPrototype;$.ajaxSetup({cache:!1,beforeSend:function(n){OpenIZ.Authentication.$elevationCredentials.$enabled&&n.setRequestHeader("Authorization","BASIC "+btoa(OpenIZ.Authentication.$elevationCredentials.userName+":"+OpenIZ.Authentication.$elevationCredentials.password));OpenIZ.App.magic||(OpenIZ.App.magic=OpenIZApplicationService.GetMagic());n.setRequestHeader("X-OIZMagic",OpenIZ.App.magic)},converters:{"text json":function(n){return $.parseJSON(n,!0)}}});$(document).ajaxError(function(n,t,i,r){t.status==401||t.status==403?OpenIZ.Authentication.$session&&OpenIZ.Authentication.$elevationCredentials.continueWith==undefined&&(OpenIZ.Authentication.$session&&OpenIZ.Authentication.$session.exp<new Date||document.cookie=="")&&window.location.hash!="/corelogin"?(console.error("Unauthorized Access:> "+n),OpenIZ.Authentication.$sessionExpiredHandler()):OpenIZ.Authentication.$elevationCredentials.continueWith&&OpenIZ.Authentication.showElevationDialog():console.warn(new OpenIZModel.Exception("Exception","err_request",r,null))});(window.onpopstate=function(){var n,i=/\+/g,r=/([^&=]+)=?([^&]*)/g,t=function(n){return decodeURIComponent(n.replace(i," "))},u=window.location.search.substring(1);for(OpenIZ.urlParams={};n=r.exec(u);)OpenIZ.urlParams[t(n[1])]=t(n[2])})();Date.prototype.getWeek=function(){var n=this.getFirstDayOfYear();return Math.ceil(((this-n)/864e5+n.getDay()+1)/7)};Date.prototype.getUTC=function(){return new Date(this.toUTCString())};Date.prototype.getFirstDayOfYear=function(){return new Date(this.getFullYear(),0,1)};Date.prototype.nextMonday=function(){var n=this.getFirstDayOfYear();return n.setDate(n.getDate()+(new Date).getWeek()*7),n};Date.prototype.addDays=function(n){var t=new Date(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());return t.setDate(t.getDate()+n),t};Date.prototype.addSeconds=function(n){var t=new Date(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());return t.setSeconds(t.getSeconds()+n),t};Date.prototype.addSeconds=function(n){var t=new Date(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());return t.setSeconds(t.getSeconds()+n),t};Date.prototype.trunc=function(){var n=new Date(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());return n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setMilliseconds(0),n};Date.prototype.tomorrow=function(){return this.addDays(1)};Date.prototype.trunc=function(){var n=new Date(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());return n.setSeconds(0),n.setHours(0),n.setMinutes(0),n.setMilliseconds(0),n};Date.prototype.yesterday=function(){return this.addDays(-1)};Date.prototype.lastWeekDay=function(n,t){var r,i;day||n||t||(r=new Date,t=r.getYear(),n=r.getMonth());i=new Date(t,n+1,0);switch(i.getDay()){case 0:i.setDate(i.getDate()-2);break;case 6:i.setDate(i.getDate()-1)}return i};String.prototype.hexDecode=function(){return this.replace(/([0-9A-Fa-f]{2})/g,function(n,t){return String.fromCharCode(parseInt(t,16))})};String.prototype.hexEncode=function(){for(var t,i="",n=0;n<this.length;n++)t=this.charCodeAt(n).toString(16),i+=("0"+t).slice(-2);return i};String.prototype.toByteArray=function(){for(var t=[],n=0;n<this.length;n++)t.push(this.charCodeAt(n));return t};String.prototype.startsWith||(String.prototype.startsWith=function(n){return this.indexOf(n)==0});