<div class="container-fluid" xmlns="http://www.w3.org/1999/xhtml" xmlns:oiz="http://openiz.org/applet">
    <oiz:script>~/controllers/common/reports/reportlist.js</oiz:script>
    <oiz:state name="org-openiz-core.reports">
        <oiz:url>/reports</oiz:url>
        <oiz:view>
            <oiz:controller>ReportListController</oiz:controller>
            <oiz:demand>1.3.6.1.4.1.33349.3.1.5.9.2.1</oiz:demand>
            <oiz:demand>1.3.6.1.4.1.33349.3.1.5.9.2.2.3</oiz:demand>
            <oiz:title lang="en">Report Centre</oiz:title>
            <oiz:title lang="fr"></oiz:title>
            <oiz:title lang="sw"></oiz:title>
        </oiz:view>
    </oiz:state>

    <div class="modal fade" id="reportParametersDialog" tabindex="-10" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                    <h4 class="modal-title">
                        <span class="glyphicon glyphicon-eye-open"></span>
                        {{ currentReport.info.title }} <small>{{ 'locale.reports.parameters.title' | i18n }}</small>
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal">
                        <div class="form-group" ng-repeat="parm in currentReport.parameter">
                            <label class="col-xs-2 control-label">{{ OpenIZ.Localization.getString(parm.label) }}</label>
                            <div class="col-xs-10" ng-switch="parm.type">
                                <input ng-model="currentFilter[parm.name]" ng-switch-when="Date" type="date" name="{{parm.name}}" max="{{ (parm.max || $root.page.loadTime) | date:'yyyy-MM-dd'}}" min="{{ (parm.min || 0 ) | date:'yyyy-MM-dd'}}" class="form-control"/>
                                <input ng-model="currentFilter[parm.name]" ng-switch-when="DateTime" type="datetime" name="{{parm.name}}" max="{{ (parm.max || $root.page.loadTime) | date:'yyyy-MM-ddTHH:mm:ss'}}" min="{{ (parm.min || 0) | date:'yyyy-MM-ddTHH:mm:ss'}}" class="form-control" />
                                <input ng-model="currentFilter[parm.name]" ng-switch-when="String" type="text" name="{{parm.name}}" class="form-control" />
                                <input ng-model="currentFilter[parm.name]" ng-switch-when="Integer" type="number" name="{{parm.name}}" class="form-control" />
                                <select ng-model="currentFilter[parm.name]" ng-switch-when="Uuid" size="1" name="{{parm.name}}" class="form-control select2">
                                    <option ng-repeat="opt in parm.valueSet.values" value="{{opt.key}}">{{opt.value}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="btn-group pull-right">
                        <button ng-click="currentReport = null" type="button" class="btn btn-danger btn-lg" data-dismiss="modal">
                            <span>
                                <span class="glyphicon glyphicon-remove"></span> {{ 'locale.action.cancel' | i18n }}
                            </span>
                        </button>
                        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#reportResultDialog" ng-click="executeReport()">
                            <span>
                                <span class="glyphicon glyphicon-play-circle"></span> {{ 'locale.action.run' | i18n }}
                            </span>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reportResultDialog" tabindex="0" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                    <h4 class="modal-title">
                        <span class="glyphicon glyphicon-object-align-bottom"></span>
                        {{ currentReport.info.title }} <small><em>{{ currentReport.info.description }}</em></small>
                    </h4>
                </div>
                <div class="modal-body">
                    <div ng-bind-html="reportBody" ng-if="!isLoading" />
                    <div ng-if="isLoading" style="min-height:200px">
                        <div class="cssload-loader">
                            <div class="cssload-inner cssload-one"></div>
                            <div class="cssload-inner cssload-two"></div>
                            <div class="cssload-inner cssload-three"></div>
                        </div>
                        <center>{{ 'locale.reports.executeWait' | i18n }}</center>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="btn-group pull-right">
                        <button ng-click="isLoading = false" type="button" class="btn btn-success btn-lg" data-dismiss="modal">
                            <span>
                                <span class="glyphicon glyphicon-ok"></span> {{ 'locale.action.done' | i18n }}
                            </span>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <div class="col-xs-12">
        <h3>{{ 'locale.reports.title' | i18n }}</h3>
        <div class="progress" ng-if="isLoading">
            <div class="progress-bar ng-cloak progress-bar-info progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
        </div>
        <table class="table table-striped" ng-if="!isLoading">
            <tr>
                <th>{{ 'locale.reports.info.name' | i18n }}</th>
                <th>{{ 'locale.reports.info.description' | i18n }}</th>
                <th>{{ 'locale.reports.info.action' | i18n }}</th>
            </tr>
            <tr ng-repeat="rpt in reports">
                <th>{{ rpt.title }}</th>
                <td>{{ rpt.description }}</td>
                <td>
                    <button ng-click="selectItem(rpt)" data-toggle="modal" data-target="#reportParametersDialog" class="btn btn-success">
                        <span>
                            <span class="glyphicon glyphicon-object-align-bottom"></span>
                            {{ 'locale.action.view' | i18n }}
                        </span>
                    </button>
                </td>
            </tr>
        </table>
    </div>
</div>
