var layoutApp=angular.module("layout",["openiz","ngSanitize","ui.router","angular.filter"]).config(["$compileProvider","$stateProvider","$urlRouterProvider",function(n,t){n.aHrefSanitizationWhitelist(/^\s*(http|tel):/);n.imgSrcSanitizationWhitelist(/^\s*(http|tel):/);var i=!1;OpenIZ.UserInterface.states.forEach(function(n){i|=n.url=="/";t.state(n)});i||t.state({name:"org-openiz-core-index",url:"/",abstract:!1,views:{"":{controller:"",templateUrl:"/org.openiz.core/views/landing.html"}}})}]).run(function(n){n.isLoading=!0;n.extendToast=null;window.location.hash==""&&(window.location.hash="#/");OpenIZ.Configuration.getConfigurationAsync({continueWith:function(t){n.system={};n.system.config=t;n.$apply()}});n.$on("$stateChangeError",function(){console.log.bind(console);OpenIZ.App.hideWait();n.isLoading=!1});n.$on("$stateChangeStart",function(){($(".modal.in").length>0||$(".modal-backdrop").length>0)&&($(".modal-open").removeClass("modal-open"),$(".modal-backdrop").remove(),$("body").css("padding-right",""));window.scrollTo(0,0);n.isLoading=!0});n.$on("$stateChangeSuccess",function(){OpenIZ.App.hideWait();n.isLoading=!1});n.page={title:OpenIZ.App.getCurrentAssetTitle(),loadTime:new Date,maxEventTime:(new Date).tomorrow(),minEventTime:(new Date).yesterday(),locale:OpenIZ.Localization.getLocale(),onlineState:OpenIZ.App.getOnlineState()};setInterval(function(){var r;if(n.page.onlineState=OpenIZ.App.getOnlineState(),n.session&&n.session.exp-new Date<12e4){var i=Math.round((n.session.exp-new Date)/1e3),u=Math.trunc(i/60),t=i%60;(""+t).length<2&&(t="0"+t);expiryStr=u+":"+t;r=OpenIZ.Localization.getString("locale.session.aboutToExpirePrefix")+expiryStr+OpenIZ.Localization.getString("locale.session.aboutToExpireSuffix");i<0?window.location.reload(!0):n.extendToast?$(n.extendToast).children(".toast-message").html(r):n.extendToast=toastr.error(r,OpenIZ.Localization.getString("locale.session.expiration"),{closeButton:!1,preventDuplicates:!0,onclick:function(){OpenIZ.Authentication.refreshSessionAsync({continueWith:function(t){n.session=t},onException:function(n){n.message?OpenIZ.App.toast(n.message):console.error(n)}});n.extendToast=null;toastr.clear()},positionClass:"toast-bottom-center",timeOut:0,extendedTimeOut:0})}n.$applyAsync()},1e4);OpenIZ.Authentication.getSessionAsync({continueWith:function(t){n.session=t;t!=null&&t.entity!=null&&(t.entity.telecom=t.entity.telecom||{},Object.keys(t.entity.telecom).length==0&&(t.entity.telecom.MobilePhone={value:""}));OpenIZ.Configuration.getUserPreferencesAsync({continueWith:function(t){var r,i;n.session.prefs={};for(r in t.application.setting)i=t.application.setting[r],n.session.prefs[i.key]=i.value;n.$apply()}});n.$apply()}});n.changeInputType=function(n,t){$(n).attr("type",t);$(n).attr("data-max-"+t)!=null&&$(n).attr("max",$(n).attr("data-max-"+t))};n.$watch("session",function(n){n&&OpenIZ.App.getInfoAsync({includeUpdates:!0,continueWith:function(n){n.update&&n.update.length>0&&toastr.info(OpenIZ.Localization.getString("locale.about.updateToast.text"),OpenIZ.Localization.getString("locale.about.updateToast.title"),{closeButton:!1,preventDuplicates:!0,onclick:function(){window.location.hash="/core/about"},positionClass:"toast-bottom-center",timeOut:4e3,extendedTimeOut:0})}})});n.OpenIZ=OpenIZ});layoutApp.service("queryUrlParameterService",[function(){function n(){for(var t=window.location.href,i=/[\?|\&]([^=]+)\=([^&]+)/g,n={};(match=i.exec(t))!=null;)n[match[1]]=match[2];return n}return{getUrlParameters:n}}]);angular.element(document).ready(function(){$("[data-toggle=popover]").popover({container:"body"});$("[data-toggle=popover]").on("shown.bs.popover",function(){$("[data-toggle=popover]").not(this).popover("hide")});$("#initialBlock").remove();$("#waitModal").removeClass("in");$("#waitModal").removeAttr("style")});layoutApp.service("uiHelperService",[function(){function n(n,t){t.outerWidth()>n.parent().width()+n.offset().left?(t.addClass("dropdown-menu-left"),t.removeClass("dropdown-menu-right")):(t.addClass("dropdown-menu-right"),t.removeClass("dropdown-menu-left"))}return{setDropdownPosition:n}}]);layoutApp.service("regexService",[function(){return{passwordRegex:/^(?=.*[a-z])(?=.*[A-Z])[a-zA-Z\d]{8,}$/}}]);