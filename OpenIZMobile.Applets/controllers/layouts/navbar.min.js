/*
 * Copyright 2015-2017 Mohawk College of Applied Arts and Technology
 * 
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you 
 * may not use this file except in compliance with the License. You may 
 * obtain a copy of the License at 
 * 
 * http://www.apache.org/licenses/LICENSE-2.0 
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the 
 * License for the specific language governing permissions and limitations under 
 * the License.
 * 
 * User: justi
 * Date: 2016-7-24
 */
layoutApp.controller("LayoutController",["$scope","$interval","$rootScope","$window",function(n,t,i,r){OpenIZ.App.getMenusAsync({continueWith:function(t){n.menuItems=t;n.$applyAsync()}});n.logout=n.logout||function(){confirm(OpenIZ.Localization.getString("locale.layout.navbar.logout.confirm"))&&OpenIZ.Authentication.abandonSession({continueWith:function(n){console.log(n);window.location.hash="#/";r.location.reload()},onException:function(n){console.log(n)}})};n.setLocale=n.setLocale||function(n){OpenIZ.Localization.setLocale(n);window.location.hash="#/";r.location.reload(!0)};n.checkMessages=function(){OpenIZ.App.getAlertsAsync({query:{flags:"!2"},continueWith:function(t){var r;if((n.messages==null||t.length!=n.messages.length)&&(r=t.length-(n.messages==null?0:n.messages.length),i.session!=null)){var u={preventDuplicates:!0,showDuration:150,hideDuration:250,timeout:2e3};n.messages&&(r==1?toastr.success(t[0].subject+"...",t[0].from,u):toastr.success(OpenIZ.Localization.getString("locale.alerts.newAlerts"),u));n.messages=t;n.$apply()}setTimeout(n.checkMessages,3e4)}});OpenIZ.Queue.getQueueAsync({queueName:OpenIZ.Queue.QueueNames.DeadLetterQueue,continueWith:function(t){n.conflicts=t},onException:function(){}})};setTimeout(n.checkMessages,3e4);n.checkMessages();n.$watch(function(){return window.innerWidth},function(t){n.windowWidth=t})}]);