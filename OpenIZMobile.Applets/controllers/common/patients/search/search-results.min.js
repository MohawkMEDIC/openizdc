layoutApp.controller("SearchResultsController",["$scope",function(n){function i(i){if(t.search.searchSubmitted=!0,!t.searchForm||t.searchForm.$valid){i?t.search.query._onlineOnly=i:delete t.search.query._onlineOnly;t.search.query._offset=0;t.search.query._count=t.search.paging.size;t.search.isSearching=!0;$(i?"#patientOnlineSearchButton":"#patientSearchButton").attr("disabled","disabled");var r=n.search.dateOfBirthStringLow,u=n.search.dateOfBirthStringHigh;OpenIZ.Patient.findAsync({query:t.search.query,continueWith:function(n){var f,i;if(r!==null&&r!==undefined&&u!=null&&u!=undefined){for(f=[],i=0;i<n.item.length;i++)n.item[i].dateOfBirth<=u&&n.item[i].dateOfBirth>=r&&f.push(n.item[i]);n.item=f}for(t.search.results=n,t.search.paging={current:1,total:n.totalResults==0?1:n.totalResults/t.search.paging.size,size:t.search.paging.size,pages:[]},i=0;i<t.search.paging.total;i++)t.search.paging.pages[i]=i+1},onException:function(n){OpenIZ.App.toast(n.message)},"finally":function(){t.search.isSearching=!1;$(i?"#patientOnlineSearchButton":"#patientSearchButton").removeAttr("disabled");t.$applyAsync()}})}}function r(){($(onlineOnly?"#patientOnlineSearchButton":"#patientSearchButton").attr("disabled","disabled"),t.search.paging.current!=t.search.paging.count)&&(t.search.paging.current++,t.search.query._offset=(t.search.paging.current-1)*t.search.paging.size,t.search.query._count=t.search.paging.size,OpenIZ.Patient.findAsync({query:t.search.query,continueWith:function(n){t.search.results=n},onException:function(n){OpenIZ.App.toast(n.message)},"finally":function(){$(onlineOnly?"#patientOnlineSearchButton":"#patientSearchButton").removeAttr("disabled");t.$apply()}}))}function u(){($(onlineOnly?"#patientOnlineSearchButton":"#patientSearchButton").attr("disabled","disabled"),t.search.paging.current!=1)&&(t.search.paging.current--,t.search.query._offset=(t.search.paging.current-1)*t.search.paging.size,t.search.query._count=t.search.paging.size,OpenIZ.Patient.findAsync({query:t.search.query,continueWith:function(n){t.search.results=n},onException:function(n){OpenIZ.App.toast(n.message)},"finally":function(){$(onlineOnly?"#patientOnlineSearchButton":"#patientSearchButton").removeAttr("disabled");t.$apply()}}))}function f(n){$(onlineOnly?"#patientOnlineSearchButton":"#patientSearchButton").attr("disabled","disabled");t.search.paging.current=n;t.search.query._offset=(t.search.paging.current-1)*t.search.paging.size;t.search.query._count=t.search.paging.size;OpenIZ.Patient.findAsync({query:t.search.query,continueWith:function(n){t.search.results=n},onException:function(n){OpenIZ.App.toast(n.message)},"finally":function(){$(onlineOnly?"#patientOnlineSearchButton":"#patientSearchButton").removeAttr("disabled");t.$apply()}})}function e(n){t.doStartEncounter(n)}var t=n;t.search=t.search||{};t.search.query=t.search.query||{};t.search.results=null;t.search.mode=0;t.search.paging=t.search.paging||{size:10};t.act={};t.$watch("search.dateOfBirthStringLow",function(t){t!==undefined&&(n.search.query.dateOfBirth=">="+OpenIZ.Util.toDateInputString(new Date(t)))});t.$watch("search.dateOfBirthStringHigh",function(t){t!==undefined&&(n.search.query.dateOfBirth="<="+OpenIZ.Util.toDateInputString(new Date(t)))});t.search.search=t.search.search||i;t.search.next=t.search.next||r;t.search.previous=t.search.previous||u;t.search.goPage=t.search.goPage||f;t.startEncounter=e;t.search.searchSubmitted=!1}]);