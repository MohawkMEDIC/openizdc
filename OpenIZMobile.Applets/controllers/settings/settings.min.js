/*
 * Copyright 2015-2017 Mohawk College of Applied Arts and Technology
 * 
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you 
 * may not use this file except in compliance with the License. You may 
 * obtain a copy of the License at 
 * 
 * http://www.apache.org/licenses/LICENSE-2.0 
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the 
 * License for the specific language governing permissions and limitations under 
 * the License.
 * 
 * User: justi
 * Date: 2016-7-24
 */
layoutApp.controller("SettingsController",["$scope",function(n){OpenIZ.Authentication.$session==null&&(OpenIZ.Authentication.$session={});OpenIZ.App.showWait();OpenIZ.Configuration.getConfigurationAsync({continueWith:function(t){n.config=t;n.config.security.port=8080;n.config.network.useProxy=n.config.network.proxyAddress!=null;n.config.network.proxyAddress=n.config.network.proxyAddress||null;n.ui={dataCollapsed:!0,securityCollapsed:!0};n.config.data.mode="sync";n.config.data.sync={event:[],enablePoll:t.sync.pollInterval,pollInterval:t.sync.pollInterval};n.config.log.mode=n.config.log.trace[0].filter||"Warning";n.config.security.hasher=OpenIZ.App.getService("IPasswordHashingService")||"SHA256PasswordHasher";n.config.security.offline={enable:!1};n.$apply()},onException:function(n){n.message!=null?console.log(n.message):console.log(n)},"finally":function(){OpenIZ.App.hideWait()}});n.master={};n.leaveRealm=function(){confirm(OpenIZ.Localization.getString("locale.settings.confirm.leaveRealm"))&&OpenIZ.Configuration.leaveRealmAsync()};n.joinRealm=function(t){var i=function(r){OpenIZ.App.showWait("#joinRealmButton");OpenIZ.Configuration.joinRealmAsync({domain:t.domain,deviceName:t.deviceName,enableTrace:t.enableTrace,enableSSL:t.enableSSL,force:r,continueWith:function(t){n.config.realmName=t.realmName;alert(OpenIZ.Localization.getString("locale.settings.status.joinRealm"));OpenIZ.App.hideWait("#joinRealmButton")},onException:function(n){n.type=="DuplicateNameException"&&(confirm(OpenIZ.Localization.getString("locale.settings.status.duplicateName"))?i(!0):n.message!=null?alert(n.message):console.log(n))},"finally":function(){OpenIZ.App.hideWait("#joinRealmButton")}})};OpenIZ.Authentication.$elevationCredentials.continueWith=i;i()};n.save=function(t){n.config.realmName==null?alert(OpenIZ.Localization.getString("locale.settings.error.noRealm")):(OpenIZ.App.showWait(),OpenIZ.App.showWait("#saveConfigButton"),OpenIZ.Configuration.saveAsync({data:t,continueWith:function(){OpenIZ.App.hideWait("#saveConfigButton");OpenIZ.App.close()}}))}}]);