angular.module("openiz",[]).provider("localize",function(){this.$get=["$rootScope","$filter",function(){var n={dictionary:OpenIZ.Localization.getStrings(OpenIZ.Localization.getLocale()),setLanguage:function(t){OpenIZ.Localization.getLocale()!=t&&(OpenIZ.Localization.setLocale(t),n.dictionary=OpenIZ.Localization.getStrings(t))},getString:function(t){var r=n.dictionary[t],i;return r!=null?r:(i=OpenIZ.Localization.getString(t),i==null)?t:i}};return n}]}).filter("i18n",["$rootScope","localize",function(n,t){var i=function(n){return t.getString(n)};return i.$stateful=!1,i}]).filter("translate",function(){return function(n){return OpenIZ.Localization.getString(n)}}).filter("orderStatus",function(){return function(n,t){return n==OpenIZModel.ActMoodKeys.Eventoccurrence&&t==OpenIZModel.StatusKeys.Active?"locale.stock.label.shipped":n==OpenIZModel.ActMoodKeys.Eventoccurrence&&t==OpenIZModel.StatusKeys.Completed?"locale.stock.label.fulfilled":t==OpenIZModel.StatusKeys.Obsolete?"locale.stock.label.cancelled":"locale.stock.label.pending"}}).filter("orderLabel",function(){return function(n,t){return n==OpenIZModel.ActMoodKeys.Eventoccurrence&&t==OpenIZModel.StatusKeys.Active?"info":n==OpenIZModel.ActMoodKeys.Eventoccurrence&&t==OpenIZModel.StatusKeys.Completed?"success":t==OpenIZModel.StatusKeys.Obsolete?"danger":"default"}}).filter("oizEntityIdentifier",function(){return function(n){if(n===undefined)return"";if(n.NID!==undefined)return n.NID.value;for(var t in n)return n[t].value}}).filter("oizConcept",function(){return function(n){if(n!=null&&n.name!=null)return OpenIZ.Util.renderConceptName(n.name)}}).filter("oizEntityName",function(){return function(n){return OpenIZ.Util.renderName(n)}}).filter("oizEntityAddress",function(){return function(n){return OpenIZ.Util.renderAddress(n)}}).directive("oizTag",function(){return{require:"ngModel",link:function(n,t,i,r){function u(n){return String(n).split(",")}function f(n){return typeof n===Array?n.join(n):n}r.$parsers.unshift(u);r.$formatters.unshift(f);n.$watch(i.ngModel,function(n,i){(typeof n=="string"&&i!=n||Array.isArray(n)&&(!Array.isArray(i)||i.length!=n.length)||$(t).attr("has-bound")===undefined)&&($(t).attr("has-bound",!0),$(t).trigger("change"))});$(t).tokenfield({delimiter:" ,",createTokensOnBlur:!0})}}}).directive("oizDatabind",function(n){return{link:function(t,i){n(function(){var h=$(i).attr("oiz-databind"),r=$(i).attr("data-filter"),u=$(i).attr("data-watch"),f=$(i).attr("data-watch-target"),e=$(i).attr("data-display"),o=$(i).attr("data-key"),n={},s;r!==undefined&&(n=JSON.parse(r));n.statusConcept="C8064CBD-FA06-4530-B430-1A52F1530C27";s=function(){$(i)[0].disabled=!0;OpenIZ.Ims.get({resource:h,query:n,"finally":function(){$(i)[0].disabled=!1},continueWith:function(n){var r=$(i)[0].options,u,t,f;$("option",i[0]).remove();r[r.length]=new Option(OpenIZ.Localization.getString("locale.common.unknown"));for(u in n.item)t=null,e!=null?(f=n.item[u],t=eval(e)):t=OpenIZ.Util.renderName(n.item[u].name.OfficialRecord),r[r.length]=o==null?new Option(t,n.item[u].id):new Option(t,eval(o))}})};u!==null&&t.$watch(u,function(t){f!==null&&t!==undefined&&(n[f]=t);s()})})}}}).directive("oizEntitysearch",function(n){return{link:function(t,i){n(function(){var r=$(i).attr("oiz-entitysearch"),u=$(i).attr("data-filter"),t=$(i).attr("data-display"),f=$(i).attr("data-default"),e=$(i).attr("data-group-by"),o=$(i).attr("data-group-display"),n={};u!==undefined&&(n=JSON.parse(u));f!==undefined&&(n=JSON.parse(f));n.statusConcept="C8064CBD-FA06-4530-B430-1A52F1530C27";$(i).attr("style","width:100%; height:100%");$(i).select2({dataAdapter:$.fn.select2.amd.require("select2/data/extended-ajax"),defaultResults:function(){return $(i[0]).attr("data-default-results")!=null?JSON.parse($(i[0]).attr("data-default-results")):$.map($("option",i[0]),function(n){return{id:n.value,text:n.innerText}})},ajax:{url:"/__ims/"+r,dataType:"json",delay:500,method:"GET",data:function(t){return n["name.component.value"]="~"+t.term,n._count=5,n._offset=0,n},processResults:function(n){var n,t,r,s,u,f;if($("option",i[0]).remove(),n=n.item||n,t={results:[]},e==null)return{results:$.map(n,function(n){return n.text=n.text||(n.name!==undefined?OpenIZ.Util.renderName(n.name.OfficialRecord):""),n})};for(r in n)try{s=eval("data[itm]."+e);u="";u=o!=null?eval(o):s;f=$.grep(t.results,function(n){return n.text==u});f.length==0?t.results.push({text:u,children:[n[r]]}):f[0].children.push(n[r])}catch(h){t.results.push(n[r])}return t},cache:!0},escapeMarkup:function(n){return n},minimumInputLength:4,templateSelection:function(n){var i="",u;switch(r){case"UserEntity":case"Provider":i+="<span class='glyphicon glyphicon-user'><\/span>";break;case"Place":i+="<span class='glyphicon glyphicon-map-marker'><\/span>";break;case"Entity":i+="<span class='glyphicon glyphicon-tag'><\/span>"}return i+="&nbsp;",t!=null?(u=n,i+=eval(t)):n.name!=null&&n.name.OfficialRecord!=null?i+=OpenIZ.Util.renderName(n.name.OfficialRecord):n.name!=null&&n.name.Assigned!=null?i+=OpenIZ.Util.renderName(n.name.Assigned):n.element!==undefined?i+=n.element.innerText:n.text!=""&&(i+=n.text),i},keepSearchResults:!0,templateResult:function(n){if(t!=null){var i=n;return eval(t)}return n.name!=null&&n.typeConceptModel!=null&&n.typeConceptModel.name!=null?"<div class='label label-default'>"+n.typeConceptModel.name[OpenIZ.Localization.getLocale()]+"<\/div> "+OpenIZ.Util.renderName(n.name.OfficialRecord):n.name!=null?"<div class='label label-default'>"+n.$type+"<\/div> "+OpenIZ.Util.renderName(n.name.OfficialRecord):n.text}})})}}}).directive("oizCollapseindicator",function(){return{link:function(n,t){$(t).on("hide.bs.collapse",function(){var n=$(this).attr("data-oiz-chevron");$(n).removeClass("glyphicon-chevron-down");$(n).addClass("glyphicon-chevron-right")});$(t).on("show.bs.collapse",function(){var n=$(this).attr("data-oiz-chevron");$(n).addClass("glyphicon-chevron-down");$(n).removeClass("glyphicon-chevron-right")})}}});