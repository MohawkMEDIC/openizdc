/**
 * @version 0.6.12 - Dalhouse
 * @copyright (C) 2015-2016, Mohawk College of Applied Arts and Technology
 * @license Apache 2.0
 */
var OpenIZApplicationService=window.OpenIZApplicationService||{},OpenIZSessionService=window.OpenIZSessionService||{},OpenIZ=OpenIZ||{urlParams:{},Act:{findAsync:function(n){OpenIZ.Ims.get({resource:"Act",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:n.query})},insertAsync:function(n){OpenIZ.Ims.post({resource:"Act",continueWith:n.continueWith,onException:n.onException,data:n.data})},getActTemplateAsync:function(n){OpenIZ.Ims.get({resource:"Act/Template",query:{templateId:n.templateId},continueWith:n.continueWith,onException:n.onException,"finally":n.finally})}},Ims:{post:function(n){$.ajax({method:"POST",url:"/__ims/"+n.resource,data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){n.continueWith!==undefined&&n.continueWith(t);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(n.onException===null)console.error(i);else if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},put:function(n){$.ajax({method:"PUT",url:"/__ims/"+n.resource+"?_id="+n.id+"&_versionId="+n.versionId,data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){n.continueWith!==undefined&&n.continueWith(t);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(n.onException===null)console.error(i);else if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},get:function(n){$.ajax({method:"GET",url:"/__ims/"+n.resource,data:n.query,dataType:"json",accept:"application/json",contentType:"application/json",success:function(t){n.continueWith!==undefined&&n.continueWith(t);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(n.onException===undefined)console.error(i);else if(i!=undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},"delete":function(n){$.ajax({method:"DELETE",url:"/__ims/"+n.resource,data:{_id:n.id},accept:"application/json",contentType:"application/json",success:function(t){n.continueWith!==undefined&&n.continueWith(t);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(n.onException===undefined)console.error(i);else if(i!=undefined&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})}},Stock:{calculateQPeriod:function(n,t){return n/12*t},calculateSReserve:function(n,t){return n*t},calculateSMax:function(n,t){return n+t},calculateSReorder:function(n,t,i,r){return n+t*i/r},calculateQOrder:function(n,t,i,r,u){return n-t+i*r/u},calculateQNeeded:function(n,t,i,r){return n+t-(i+r)},calculateAll:function(n,t,i,r,u){var f={};return f.qPeriod=OpenIZ.Stock.calculateQPeriod(n,t),f.sReserve=OpenIZ.Stock.calculateSReserve(f.qPeriod,i),f.sMax=OpenIZ.Stock.calculateSMax(f.qPeriod,f.sReserve),f.sReorder=OpenIZ.Stock.calculateSReorder(f.sReserve,f.qPeriod,r,t),f.qOrder=OpenIZ.Stock.calculateQOrder(f.sMax,u,f.qPeriod,r,t),f}},Util:{simpleGet:function(n,t){t.onException=t.onException||OpenIZ.Util.logException;$.getJSON(n,t.query,function(n){if(n!=null&&n.error!==undefined)t.onException(new OpenIZModel.Exception(n.error),n.error_description,null);else if(n!=null)t.continueWith(n);else t.onException(new OpenIZModel.Exception("err_general",n,null))}).error(function(n){var i=n.responseJSON;if(i!=null&&i.error!==undefined)t.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else t.onException(new OpenIZModel.Exception("err_general"+i,n,null))}).always(function(){t.finally!==undefined&&t.finally()})},renderAddress:function(n){if(n!==undefined){var t=n.component!==undefined?n:n.address!==undefined?n.address.Direct||n.address.HomeAddress:n.Direct||n.HomeAddress,i="";return t.component.AdditionalLocator&&(i+=t.component.AdditionalLocator+", "),t.component.StreetAddressLine&&(i+=t.component.StreetAddressLine+", "),t.component.City&&(i+=t.component.City+", "),t.component.County!=null&&(i+=t.component.County+", "),t.component.State!=null&&(i+=t.component.State+", "),t.component.Country!=null&&(i+=t.component.Country+", "),i.substring(0,i.length-2)}},renderAct:function(n){switch(n.$type){case"SubstanceAdministration":return OpenIZ.Localization.getString("locale.encounters.administer")+OpenIZ.Util.renderName(n.participation.Product.name.OfficialRecord);case"QuantityObservation":case"CodedObservation":case"TextObservation":return OpenIZ.Localization.getString("locale.encounters.observe")+n.typeConceptModel.name[OpenIZ.Localization.getLocale()];default:return""}},logException:function(n){console.warn(n)},renderManufacturedMaterial:function(n){var t=OpenIZ.Util.renderName(n.name.OfficialRecord||n.name.Assigned);return t+"[LN#: "+n.lotNumber+"]"},renderName:function(n){if(n===null||n===undefined)return"";if(n.join!==undefined)return n.join(" ");if(n.component!==undefined){var t="";return n.component.Given!==undefined&&(typeof n.component.Given=="string"?t+=n.component.Given:n.component.Given.join!==undefined&&(t+=n.component.Given.join(" ")),t+=" "),n.component.Family!==undefined&&(typeof n.component.Family=="string"?t+=n.component.Family:n.component.Family.join!==undefined&&(t+=n.component.Family.join(" "))),n.component.$other!==undefined&&(typeof n.component.$other=="string"?t+=n.component.$other:n.component.$other.join!==undefined?t+=n.component.$other.join(" "):n.component.$other.value!==undefined&&(t+=n.component.$other.value)),t}return n},toDateInputString:function(n){return n.toISOString().substring(0,10)},startTaskAsync:function(n,t){return setTimeout(function(){try{t.continueWith(n())}catch(i){if(t.onException===undefined)console.error(i);else t.onException(i)}},0)}},Authentication:{$session:null,$elevationCredentials:{},showElevationDialog:function(){$("#authenticationDialog").modal("show")},hideElevationDialog:function(){$("#authenticationDialog").modal("hide")},loginAsync:function(n){$.ajax({method:"POST",url:"/__auth/authenticate",data:{username:n.userName,password:n.password,grant_type:"password",scope:n.scope},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t,i){if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error),i.error_description,null);else if(i!=null)n.continueWith(i),OpenIZ.Authentication.$session=i;else n.onException(new OpenIZModel.Exception("err_general",i,null));n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},setPasswordAsync:function(n){$.ajax({method:"POST",url:"/__auth/passwd",data:{username:n.userName,password:n.password},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t,i){if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error),i.error_description,null);else if(i!=null)n.continueWith(i);else n.onException(new OpenIZModel.Exception("err_general",i,null));n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},getSessionAsync:function(n){OpenIZ.Util.simpleGet("/__auth/get_session",n)},abandonSession:function(n){$.ajax({method:"POST",url:"/__auth/abandon",dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t,i){n.continueWith(i);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},refreshSessionAsync:function(){},getUserAsync:function(n){OpenIZ.Ims.get({resource:"UserEntity",query:n.query,continueWith:n.continueWith,onException:n.onException,"finally":n.finally})}},CarePlan:{interpretObservation:function(n){n.interpretationConcept="41d42abf-17ad-4144-bf97-ec3fd907f57d"},getCarePlanAsync:function(n){var t="/__plan/patient?moodConcept=ACF7BAF2-221F-4BC2-8116-CEB5165BE079";n.minDate!==undefined&&(t+="&actTime=>"+n.minDate.toISOString());n.maxDate!==undefined&&(t+="&actTime=<"+n.maxDate.toISOString());n.onDate!==undefined&&(t+="&startTime=<"+n.onDate.toISOString()+"&stopTime=>"+n.onDate.toISOString());n.classConcept!==undefined&&(t+="&classConcept="+n.classConcept);n.query!==undefined&&(t+="&"+n.query);console.info("Generating care plan...");$.ajax({method:"POST",url:t,data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){console.info("Retrieved care plan...");n.continueWith(t);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(n.onException!==undefined)if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})},getEntityTemplateAsync:function(n){OpenIZ.Entity.getEntityTemplateAsync(n)},getActTemplateAsync:function(n){OpenIZ.Act.getActTemplateAsync(n)}},App:{newGuid:function(){return OpenIZApplicationService.NewGuid()},getInfoAsync:function(n){OpenIZ.Util.simpleGet("/__app/info",n)},getOnlineState:function(){return OpenIZApplicationService.GetOnlineState()},statusShown:!1,resolveTemplate:function(n){return OpenIZApplicationService.GetTemplateForm(n)},updateStatus:function(){var n=JSON.parse(OpenIZApplicationService.GetStatus());n[1]>0&&n[1]<1?($("#waitModalText").text(OpenIZ.Localization.getString("locale.dialog.wait.background")+":"+n[0]),$("#waitProgressBar").attr("style","width:"+n[1]*100+"%")):($("#waitModalText").text(OpenIZ.Localization.getString("locale.dialog.wait.text")+":"+n[0]),$("#waitProgressBar").attr("style","width:100%"));OpenIZ.App.statusShown&&setTimeout(OpenIZ.App.updateStatus,1e3)},showWait:function(n){n!=null?$("#waitModalText").text(n):setTimeout(OpenIZ.App.updateStatus,6e3);OpenIZ.App.statusShown||($("#waitModal").modal({show:!0,backdrop:"static"}),OpenIZ.App.statusShown=!0)},networkAvailable:function(){try{return OpenIZApplicationService.GetNetworkState()}catch(n){return!1}},hideWait:function(){OpenIZ.App.statusShown=!1;$("#waitModal").modal("hide")},getService:function(n){for(var t in OpenIZ.Configuration.$configuration.application.service)if(OpenIZ.Configuration.$configuration.application.service[t].lastIndexOf(n)>0)return OpenIZ.Configuration.$configuration.application.service[t];return null},getVersion:function(){return OpenIZApplicationService.GetVersion()},getCurrentAssetTitle:function(){return $(document).find("title").text()},getMenusAsync:function(n){OpenIZ.Util.simpleGet("/__app/menu",n)},scanBarcode:function(){try{var t=OpenIZApplicationService.BarcodeScan();return console.log("Barcode scan complete. Data: "+t),t}catch(n){console.error(n);throw new OpenIZModel.Exception(OpenIZ.Localization.getString("err_scan_barcode"),n.message,n);}},back:function(){try{var t=OpenIZApplicationService.Back()}catch(n){console.error(n)}},close:function(){try{var t=OpenIZApplicationService.Close()}catch(n){console.error(n)}},toast:function(n){try{var i=OpenIZApplicationService.ShowToast(n)}catch(t){console.error(t)}},navigateApplet:function(n,t){try{OpenIZApplicationService.Navigate(n,JSON.stringify(t))}catch(i){console.error(i)}},getAlertsAsync:function(n){OpenIZ.Util.simpleGet("/__app/alerts",n)},saveAlertAsync:function(n){$.ajax({method:"POST",url:"/__app/alerts",data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t){n.continueWith!==undefined&&n.continueWith(t);n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(n.onException===null)console.error(i);else if(i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})}},Localization:{getString:function(n){try{return OpenIZApplicationService.GetString(n)}catch(t){return console.error(t),n}},getLocale:function(){return(navigator.language||navigator.userLanguage).substring(0,2)},setLocale:function(n){return OpenIZApplicationService.SetLocale(n)},getStrings:function(n){try{var i=OpenIZApplicationService.GetStrings(n);return i==null?null:JSON.parse(i)}catch(t){console.error(t);throw new OpenIZModel.Exception("Error getting string list",t.message,t);}}},Concept:{findConceptAsync:function(n){OpenIZ.Ims.get({resource:"Concept",query:n.query,continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},findConceptSetAsync:function(n){OpenIZ.Ims.get({resource:"ConceptSet",query:n.query,continueWith:n.continueWith,onException:n.onException,"finally":n.finally})}},Bundle:{insertAsync:function(n){OpenIZ.Ims.post({resource:"Bundle",continueWith:n.continueWith,onException:n.onException,data:n.data})}},Patient:{findAsync:function(n){OpenIZ.Ims.get({resource:"Patient",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:n.query})},insertAsync:function(n){OpenIZ.Ims.post({resource:"Patient",continueWith:n.continueWith,onException:n.onException,data:n.data})},updateAsync:function(n){OpenIZ.Ims.put({resource:"Patient",data:n.data,id:n.id,continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},obsoleteAsync:function(n){OpenIZ.Ims.delete({resource:"Patient",id:n.id,continueWith:n.continueWith,onException:n.onException,"finally":n.finally})},getAsync:function(n){OpenIZ.Ims.get({resource:"Patient",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:{_id:n.patientId}})}},Place:{findAsync:function(n){OpenIZ.Ims.get({resource:"Place",continueWith:n.continueWith,onException:n.onException,"finally":n.finally,query:n.query})},bindSelect:function(n,t){$(n).select2({ajax:{url:"/__ims/Place",dataType:"json",delay:500,method:"GET",data:function(n){return t["name.component.value"]="~"+n.term,t._count=5,t._offset=0,t},processResults:function(n,t){return t.page=t.page||0,{results:n.item,pagination:{more:n.offset+n.count<n.total}}},cache:!0},escapeMarkup:function(n){return n},minimumInputLength:4,templateSelection:function(n){return n.name!=null?"<span class='glyphicon glyphicon-map-marker'><\/span> "+n.name.OfficialRecord.component.$other.value:"<span class='glyphicon glyphicon-map-marker'><\/span> "+n.text},templateResult:function(n){return n.text!=null?n.text:"<div class='label label-default'>"+n.typeConceptModel.name[OpenIZ.Localization.getLocale()]+"<\/div> "+n.name.OfficialRecord.component.$other.value}})}},Provider:{findProviderAsync:function(n){OpenIZ.Ims.get({continueWith:n.continueWith,onException:n.onException,"finally":n.finally,resource:"Provider",query:n.query})},bindSelect:function(n,t){$(n).select2({ajax:{url:"/__ims/Provider",dataType:"json",delay:500,method:"GET",data:function(n){return t["name.component.value"]="~"+n.term,t._count=5,t._offset=0,t},processResults:function(n,t){return t.page=t.page||0,{results:n.item,pagination:{more:n.offset+n.count<n.total}}},cache:!0},escapeMarkup:function(n){return n},minimumInputLength:1,templateSelection:function(n){return n.text!=null?"<span class='glyphicon glyphicon-user'><\/span> "+n.text:"<span class='glyphicon glyphicon-user'><\/span> "+OpenIZ.Util.renderName(n.name.OfficialRecord)},templateResult:function(n){return n.text!=null?n.text:"<span class='glyphicon glyphicon-user'><\/span> "+OpenIZ.Util.renderName(n.name.OfficialRecord)}})}},Entity:{getEntityTemplateAsync:function(n){OpenIZ.Ims.get({resource:"Entity/Template",query:{templateId:n.templateId},continueWith:n.continueWith,onException:n.onException,"finally":n.finally})}},Configuration:{$configuration:null,getConfigurationAsync:function(n){OpenIZ.Util.simpleGet("/__config/all",{continueWith:function(t){OpenIZ.Configuration.$configuration=t;n.continueWith(t)},onException:n.onException,"finally":n.finally})},getApplicationSetting:function(n){try{for(var i in OpenIZ.Configuration.$configuration.application.setting)if(OpenIZ.Configuration.$configuration.application.setting[i].key==n)return OpenIZ.Configuration.$configuration.application.setting[i].value;return null}catch(t){throw new OpenIZModel.Exception(t.message,t.detail,t);}},setApplicationSetting:function(n,t){try{for(var r in OpenIZ.Configuration.$configuration.application.setting)if(OpenIZ.Configuration.$configuration.application.setting[r].key==n){OpenIZ.Configuration.$configuration.application.setting[r].value=t;return}OpenIZ.Configuration.$configuration.application.setting.push({key:n,value:t})}catch(i){throw new OpenIZModel.Exception(i.message,i.detail,i);}},getRealm:function(){try{return OpenIZ.Configuration.$configuration.realmName}catch(n){console.error(n)}},getSection:function(n){try{return OpenIZ.Configuration.$configuration[n]}catch(t){console.error(t)}},joinRealmAsync:function(n){try{$.ajax({method:"POST",url:"/__config/realm",data:{realmUri:n.domain,deviceName:n.deviceName},dataType:"json",contentType:"application/x-www-urlform-encoded",success:function(t,i){if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error),i.error_description,null);else if(i!=null)OpenIZ.Configuration.$configuration=t,n.continueWith(t);else if(n.onException!=null)n.onException(new OpenIZModel.Exception("err_general",i,null));n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else if(n.onException!=null)n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})}catch(t){console.error(t)}},leaveRealm:function(){try{return confirm("You are about to leave the realm "+configuration.realm.address+". Doing so will force the OpenIZ back into an initial configuration mode. Are you sure you want to do this?")?OpenIZConfigurationService.LeaveRealm():!1}catch(n){console.error(n)}},saveAsync:function(n){try{$.ajax({method:"POST",url:"/__config/all",data:JSON.stringify(n.data),dataType:"json",contentType:"application/json",success:function(t,i){if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error),i.error_description,null);else if(i!=null)OpenIZ.Configuration.$configuration=t,n.continueWith(t);else n.onException(new OpenIZModel.Exception("err_general",i,null));n.finally!==undefined&&n.finally()},error:function(t){var i=t.responseJSON;if(i!=null&&i.error!==undefined)n.onException(new OpenIZModel.Exception(i.error,i.error_description,null));else n.onException(new OpenIZModel.Exception("err_general"+i,t,null));n.finally!==undefined&&n.finally()}})}catch(t){console.error(t)}},getAppletSettings:function(){},saveAppletSettings:function(){},getUserPreferences:function(){},saveUserPreferences:function(){}},ManufacturedMaterial:{getManufacturedMaterials:function(n){OpenIZ.ManufacturedMaterial.getManufacturedMaterialAsync(n)},getManufacturedMaterialAsync:function(n){OpenIZ.Ims.get({resource:"ManufacturedMaterial",continueWith:n.continueWith,onException:n.onException,query:n.query})}},UserEntity:{updateAsync:function(n){OpenIZ.Ims.put({resource:"UserEntity",continueWith:n.continueWith,onException:n.onException,data:n.data})}}};$.ajaxSetup({cache:!1,converters:{"text json":$.parseJSON},beforeSend:function(n){OpenIZ.Authentication.$elevationCredentials.$enabled&&n.setRequestHeader("Authorization","BASIC "+btoa(OpenIZ.Authentication.$elevationCredentials.userName+":"+OpenIZ.Authentication.$elevationCredentials.password));n.setRequestHeader("X-OIZMagic",OpenIZSessionService.GetMagic())}});$(document).ajaxError(function(n,t,i,r){if((t.status==401||t.status==403)&&OpenIZ.Authentication.$session!=null)OpenIZ.Authentication.showElevationDialog();else throw new OpenIZModel.Exception("err_request",r,null);});(window.onpopstate=function(){var n,i=/\+/g,r=/([^&=]+)=?([^&]*)/g,t=function(n){return decodeURIComponent(n.replace(i," "))},u=window.location.search.substring(1);for(OpenIZ.urlParams={};n=r.exec(u);)OpenIZ.urlParams[t(n[1])]=t(n[2])})();